!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var i=e();for(var r in i)("object"==typeof exports?exports:t)[r]=i[r]}}(window,(function(){return function(t){var e={};function i(r){if(e[r])return e[r].exports;var n=e[r]={i:r,l:!1,exports:{}};return t[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=t,i.c=e,i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(r,n,function(e){return t[e]}.bind(null,n));return r},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=1)}([function(t,e,i){var r,n,s,o=function t(e){this.ctx=null,this.canvasDom=null,this.layerList=[],this.photoManager=null,this.layerManager=null,this.ticker=null,this.debugger=null,this.loader=new t.Loader(this),this.ajax=new t.Ajax,this.baseUI=null,this.gesture=null,this.config=t.utils.extend({debugDrawContainer:!1,appenv:"h5"},e||{}),this.isMobile=t.utils.isMobile(),this.stageW=0,this.stageH=0,this.dpi=this.getSystemInfo().devicePixelRatio};(o.prototype.getStageWidth=function(){return this.canvasDom.width},o.prototype.getStageHeight=function(){return this.canvasDom.height},o.prototype.bindCanvas=function(t){return this.canvasDom=t,this.ctx=t.getContext("2d"),this.ctx.canvas.getBoundingClientRect=this.ctx.canvas.getBoundingClientRect?this.ctx.canvas.getBoundingClientRect:function(){return{left:0,top:0}},this.layerList=[],this.photoManager=new o.PhotoManager(this),this.layerManager=new o.LayerManager(this),this.ticker=new o.Ticker(this),this.debugger=new o.Debugger(this),this.baseUI=new o.UI(this),this.init(),this},o.prototype.init=function(){this._initStageGestureEvent(),this.ticker.start(6)},o.prototype._initStageGestureEvent=function(){function t(t){var r=parseInt(t.clientX-i.ctx.canvas.getBoundingClientRect().left),n=parseInt(t.clientY-i.ctx.canvas.getBoundingClientRect().top),s=i.getUIFromPointer(new o.Math.Dot(r,n));s&&s.triggerUIEventBubbleUp(t.type,r,n,t),e(t.type,r,n)}function e(t,e,r){for(var n=i.layerList.length-1;n>=0;n--){var s=i.layerList[n];s.enableEventManager&&s.enableEventManager&&s.triggerListener(t,new o.Event({type:t,x:e,y:r}))}}var i=this,r={},n="",s=new o.Gesture({target:this.ctx.canvas});this.gesture=s,s.addListener("tap",t),s.addListener("longtap",t),s.addListener("doubletap",t),s.addListener("swipe",t),s.addListener("swipeleft",t),s.addListener("swiperight",t),s.addListener("swipeup",t),s.addListener("swipedown",t),s.addListener("dragstart",(function(t){var s=parseInt(t.clientX-i.ctx.canvas.getBoundingClientRect().left),h=parseInt(t.clientY-i.ctx.canvas.getBoundingClientRect().top);n="";var a=i.getUIFromPointer(new o.Math.Dot(s,h));a&&(r[t.identifier]=a,a.triggerUIEventBubbleUp(t.type,s,h)),e(t.type,s,h)})),s.addListener("dragging",(function(t){var s=parseInt(t.clientX-i.ctx.canvas.getBoundingClientRect().left),o=parseInt(t.clientY-i.ctx.canvas.getBoundingClientRect().top);if(n!==s+"_"+o){n=s+"_"+o;var h=r[t.identifier];h&&(r[t.identifier]=h,h.triggerUIEventBubbleUp(t.type,s,o)),e(t.type,s,o)}})),s.addListener("dragend",(function(t){var n=parseInt(t.clientX-i.ctx.canvas.getBoundingClientRect().left),s=parseInt(t.clientY-i.ctx.canvas.getBoundingClientRect().top),o=r[t.identifier];o&&(r[t.identifier]=o,o.triggerUIEventBubbleUp(t.type,n,s),o=null,r[t.identifier]=null),e(t.type,n,s)})),s.addListener("mousemove",t)},o.prototype.clearStage=function(){this.ctx.clearRect(0,0,this.getStageWidth(),this.getStageHeight())},o.prototype.findLayerById=function(t){for(var e=0;e<this.layerList.length;e++){var i=this.layerList[e];if(i.id===t)return i}return null},o.prototype.findUiById=function(t){for(var e=0;e<this.layerList.length;e++)for(var i=this.layerList[e],r=0;r<i.uiList.length;r++){var n=i.uiList[r];if(n.id===t)return n}return null},o.prototype.getUIFromPointer=function(t,e){e=!o.utils.isBoolean(e)||e;for(var i=this.layerList.length-1;i>=0;i--){var r=this.layerList[i];if(!r.ghost&&(!e||r.show)){var n=r.getUIFromPointer(t,e);if(n)return n}}return null},o.prototype.getUIListFromPointer=function(t,e){e=e||{uiIsShow:!0,uiIsGhost:!1};for(var i=[],r=this.layerList.length-1;r>=0;r--){var n=this.layerList[r];if(n.show){var s=n.getUIListFromPointer(t);i=i.concat(s)}}return i.filter((function(t){return t.show===e.uiIsShow&&t.ghost===e.uiIsGhost}))},o.prototype.createCanvas=function(t){t=t||{};var e=o.utils.mergeObject({width:this.getSystemInfo().windowWidth,height:this.getSystemInfo().windowHeight,dpiAdaptation:!1,canvasDom:null},t),i=e.canvasDom||document.createElement("canvas"),r=this.getSystemInfo().devicePixelRatio;return e.dpiAdaptation?(i.width=e.width*r,i.height=e.height*r,i.style&&(i.style.width=e.width+"px")):(i.width=e.width,i.height=e.height),i.style&&(i.style.display="block"),i},o.prototype.getSystemInfo=function(){return{model:"iPhone 5",pixelRatio:window.devicePixelRatio||1,windowWidth:window.innerWidth,windowHeight:window.innerHeight,screenWidth:320,screenHeight:568,devicePixelRatio:window.devicePixelRatio||1}},o.prototype.createCacheCtx=function(t){t=t||{width:this.getStageWidth(),height:this.getStageHeight()};var e=this.createCanvas({width:t.width,height:t.height}).getContext("2d");return document.body.appendChild(e.canvas),e},(s=o).utils={},s.utils.extend=function(t,e,i){for(var r in i&&(e=s.utils.deepClone(e)),t)t.hasOwnProperty(r)&&e&&void 0!==e[r]&&(t[r]=e[r]);return t},s.utils.mergeObject=function(t,e){for(var i in e=e||{})e.hasOwnProperty(i)&&void 0!==e[i]&&(t[i]=e[i]);return t},s.utils.isString=function(t){return"string"==typeof t},s.utils.isNum=function(t){return"number"==typeof t},s.utils.isBoolean=function(t){return"boolean"==typeof t},s.utils.isObj=function(t){return"object"==typeof t},s.utils.isFn=function(t){return"function"==typeof t},s.utils.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)},s.utils.isMobile=function(){for(var t=navigator.userAgent,e=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],i=!1,r=0;r<e.length;r++)if(t.indexOf(e[r])>0){i=!0;break}return i},s.utils.deepClone=function(t){function e(t){var r={};for(var n in t)t.hasOwnProperty(n)&&(r[n]=t[n],s.utils.isArray(t[n])?r[n]=i(t[n]):s.utils.isObj(t[n])?r[n]=e(t[n]):r[n]=t[n]);return r}function i(t){for(var r=[],n=null,o=0;o<t.length;o++)n=t[o],s.utils.isArray(n)?r.push(i(n)):s.utils.isObj(n)?r.push(e(n)):r.push(n);return r}return s.utils.isArray(t)?i(t):e(t)},s.utils.renderTpl=function(t,e){return t.replace(/__.+?__/g,(function(t){console.log("匹配到的文本--\x3e",t);var i=t.slice(2).slice(0,-2).trim();return void 0!==e[i]?e[i]:t}))},s.utils.releaseObject=function(t){for(var e in t)t.hasOwnProperty(e)&&delete t[e]},s.utils.releaseArray=function(t){t.length=0},s.utils.isWx=function(){return"undefined"!=typeof wx},function(t){t.utils.extend,t.Math=function(){},t.Math.Dot=function(t){this.x=0,this.y=0;var e=arguments.length;1===e?(this.x=t.x,this.y=t.y):2===e&&(this.x=arguments[0],this.y=arguments[1])},t.Math.Dot.prototype.isInRect=function(t){return this.x>=t.x&&this.x<=t.x+t.width&&this.y>=t.y&&this.y<=t.y+t.height},t.Math.Dot.prototype.isEqual=function(t){return this.x===t.x&&this.y===t.y},t.Math.Dot.prototype.plus=function(e){return new t.Math.Dot(this.x+e.x,this.y+e.y)},t.Math.Dot.prototype.rotate=function(e,i){i=i||new t.Math.Dot(0,0);var r=this.x,n=this.y,s=i.x,o=i.y,h=(r-s)*Math.cos(e/180*Math.PI)-(n-o)*Math.sin(e/180*Math.PI)+s,a=(n-o)*Math.cos(e/180*Math.PI)+(r-s)*Math.sin(e/180*Math.PI)+o;return new t.Math.Dot(h,a)},t.Math.Dot.threeDotIsOnLine=function(t,e,i){return!!(t.isEqual(e)||t.isEqual(i)||e.isEqual(i))||(t.x===e.x&&e.x===i.x||Math.abs(t.y-e.y)/Math.abs(t.x-e.x)===Math.abs(t.y-i.y)/Math.abs(t.x-i.x))},t.Math.Rect=function(e){this.yccClass=t.Math.Rect,this.x=0,this.y=0,this.width=0,this.height=0;var i=arguments.length;1===i?(this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height):3===i?(this.x=arguments[0].x,this.y=arguments[0].y,this.width=arguments[1],this.height=arguments[2]):4===i&&(this.x=arguments[0],this.y=arguments[1],this.width=arguments[2],this.height=arguments[3]),this.toPositive()},t.Math.Rect.prototype.toPositive=function(){var t=this.x,e=this.y,i=this.x+this.width,r=this.y+this.height;this.x=t<i?t:i,this.y=e<r?e:r,this.width=Math.abs(this.width),this.height=Math.abs(this.height)},t.Math.Rect.prototype.getVertices=function(){return[new t.Math.Dot(this.x,this.y),new t.Math.Dot(this.x+this.width,this.y),new t.Math.Dot(this.x+this.width,this.y+this.height),new t.Math.Dot(this.x,this.y+this.height),new t.Math.Dot(this.x,this.y)]},t.Math.Rect.prototype.updateByVertices=function(e){return t.utils.isArray(e)?(this.x=e[0].x,this.y=e[0].y,this.width=e[1].x-this.x,void(this.height=e[2].y-this.y)):console.error("参数必须是数组！")},t.Math.Vector=function(){this.x=0,this.y=0,this.z=0,3!==arguments.length&&2!==arguments.length||(this.x=arguments[0]||0,this.y=arguments[1]||0,this.z=arguments[2]||0),1===arguments.length&&(t.utils.isObj(arguments[0])||console.error("constructor need a objec as param!"),this.x=arguments[0].x||0,this.y=arguments[0].y||0,this.z=arguments[0].z||0)},t.Math.Vector.prototype.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},t.Math.Vector.prototype.cross=function(e){var i=new t.Math.Vector;return i.x=this.y*e.z-e.y*this.z,i.y=e.x*this.z-this.x*e.z,i.z=this.x*e.y-e.x*this.y,i},t.Math.Vector.prototype.getLength=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z,2)},t.Math.Matrix=function(t,e,i){this.data=t,this.m=e,this.n=i},t.Math.Matrix.prototype.dot=function(e){if(e.m!==this.n||e.n!==this.m)return console.error("两个矩阵的行数和列数不对应，不能相乘！");for(var i=new t.Math.Matrix([],this.m,this.m),r=1;r<=this.m;r++)for(var n=1;n<=this.m;n++){for(var s=0,o=1;o<=this.n;o++)s+=this.get(r,o)*e.get(o,n);i.set(r,n,s)}return i},t.Math.Matrix.prototype.get=function(t,e){return this.data[(t-1)*this.n+e-1]},t.Math.Matrix.prototype.set=function(t,e,i){this.data[(t-1)*this.n+e-1]=i}}(o),function(t){var e=1,i={};t.Tree=function(){this.$id=e++,this.$parentID=null,this.children=[],this.data=null,i[this.$id]=this},t.Tree.release=function(t){var e=t.getParent();if(e){var r=e.children,n=r.indexOf(t);-1!==n&&(r[n]=null)}delete i[t.$id],t.children.length=0,t.data=null},t.Tree.getNodeMap=function(){return i},t.Tree.prototype.getNodeMap=function(){return i},t.Tree.prototype.getParent=function(){return this.$parentID?i[this.$parentID]:null},t.Tree.prototype.addChildTree=function(t){return t.$parentID?console.error("sub tree's parent has exist! can't add!",t):(t.$parentID=this.$id,this.children.push(t),this)},t.Tree.prototype.removeChildTree=function(t){var e=this.children.indexOf(t);return-1===e||this.children.splice(e,1),this},t.Tree.prototype.getDepth=function(){var t=this,e=1;if(t.children.length>0)for(var i=0;i<t.children.length;i++){var r=t.children[i].getDepth();e=r+1>e?r+1:e}return e},t.Tree.prototype.itor=function(t){function e(n,s,o){if(0===n.length)return!0;o=o||0,o++;for(var h=t.reverse?i(n):n,a=[],c=!1,l=0;l<h.length;l++){var u=s.call(r,h[l],o);if(!0===u){c=!0;break}-1!==u&&(a=a.concat(t.reverse?i(h[l].children):h[l].children))}return c&&(a=[]),t.reverse&&a.reverse(),e(a,s,o)}function i(t){for(var e=[],i=t.length-1;i>=0;i--)e.push(t[i]);return e}var r=this;return t=t||{reverse:!1},{each:function(t){if(t.call(r,r))return!0;if(r.children.length>0)for(var e=0;e<r.children.length;e++)if(r.children[e].itor().each(t))return!0;return!1},leftChildFirst:function(t){if(r.children.length>0)for(var e=0;e<r.children.length;e++)if(r.children[e].itor().leftChildFirst(t))return!0;if(t.call(r,r))return!0},rightChildFirst:function(t){if(r.children.length>0)for(var e=r.children.length-1;e>=0;e--)if(r.children[e].itor().rightChildFirst(t))return!0;if(t.call(r,r))return!0},depthDown:function(t){e([r],t)}}},t.Tree.prototype.toNodeList=function(){var t=[];return this.itor().depthDown((function(e){t.push(e)})),t},t.Tree.prototype.getNodeListGroupByLayer=function(){var t={};return this.itor().depthDown((function(e,i){t[i]||(t[i]=[]),t[i].push(e)})),t},t.Tree.prototype.getParentList=function(){for(var t=this,e=[];t.$parentID;){var r=i[t.$parentID];e.unshift(r),t=r}return e},t.Tree.prototype.getBrotherList=function(){return this.$parentID?i[this.$parentID].children:[this]},t.Tree.createByJSON=function(e){var i=new t.Tree;if(i.data=e.data,t.utils.isArray(e.children)&&e.children.length>0)for(var r=0;r<e.children.length;r++)i.addChildTree(t.Tree.createByJSON(e.children[r]));return i},t.Tree.createByNodes=function(e){if(!t.utils.isArray(e)||0===e.length)return console.error("need an Array as param!");var i=null,r=[];return e.forEach((function(e){var n=new t.Tree;n.data=e,r.push(n),t.utils.isNum(e.parentID)||e.parentID||(i=n)})),r.forEach((function(t){r.forEach((function(e){e.data.parentID===t.data.id&&t.addChildTree(e)}))})),i}}(o),function(t){var e=1,i=1,r=1,n={},s={};t.Graph=function(t){this.type=t||1,this.$id=r++,this.vList=[],this.eList=[]},t.Graph.prototype.getMapV=function(){return n},t.Graph.prototype.getMapE=function(){return s},t.Graph.prototype.bfs=function(t,e,i){if(t=t||[],(i=i||[]).length===this.vList.length)return!0;if(0===t.length){for(var r=null,s=0;s<this.vList.length;s++)if(-1===i.indexOf(this.vList[s].$id)){r=this.vList[s].$id;break}return this.bfs([r],e,i)}for(var o=null,h=0;h<t.length;h++){if(o=n[t[h]],e.call(this,o))return!0;i.push(o.$id)}for(var a=[],c=0;c<t.length;c++){var l=(o=n[t[c]]).getAccessibleIds().filter((function(t){return-1===i.indexOf(t)}));a=a.concat(l)}return this.bfs(a,e,i)},t.Graph.prototype.dfs=function(t,e,i){i=i||[];var r=n[t];if(i.push(r.$id),e.call(this,r))return!0;for(var s=r.getAccessibleIds(),o=0;o<s.length;o++){var h=s[o];if(-1===i.indexOf(h)&&this.dfs(h,e,i))return!0}if(i.length===this.vList.length)return!0;for(var a=null,c=0;c<this.vList.length;c++)if(-1===i.indexOf(this.vList[c].$id)){a=this.vList[c].$id;break}return this.dfs(a,e,i)},t.Graph.createDirectedGraph=function(e,i){var r=new t.Graph(1),n=r.vList,s=r.eList;return e.forEach((function(e){n.push(new t.Graph.DirectedV(e))})),i.forEach((function(e){for(var i=null,r=null,o=new t.Graph.DirectedE,h=0;h<n.length&&(!i||!r);h++){var a=n[h];a.data.id===e.fromId&&(i=a,a.outIDs.push(o.$id)),a.data.id===e.toId&&(r=a,a.inIDs.push(o.$id))}o.init(i.$id,r.$id,e),s.push(o)})),r},t.Graph.DirectedV=function(t){this.$id=e++,this.data=t,this.inIDs=[],this.outIDs=[],n[this.$id]=this},t.Graph.DirectedV.prototype.getAccessibleIds=function(){var t=[];return this.outIDs.forEach((function(e){t.push(s[e].toID)})),t},t.Graph.DirectedE=function(){this.$id=i++,this.data=null,this.fromID=null,this.toID=null,s[this.$id]=this},t.Graph.DirectedE.prototype.init=function(t,e,i){this.fromID=t,this.toID=e,this.data=i},t.Graph.createUnDirectedGraph=function(e,i){var r=new t.Graph(2),n=r.vList,s=r.eList;return e.forEach((function(e){n.push(new t.Graph.UnDirectedV(e))})),i.forEach((function(e){for(var i=[],r=new t.Graph.UnDirectedE,o=0;o<n.length;o++){var h=n[o];if(2===i.length)break;h.data.id!==e.ids[0]&&h.data.id!==e.ids[1]||(i.push(h.$id),h.eIDs.push(r.$id))}r.init(i,e),s.push(r)})),r},t.Graph.UnDirectedV=function(t){this.$id=e++,this.data=t,this.eIDs=[],n[this.$id]=this},t.Graph.UnDirectedV.prototype.getAccessibleIds=function(){for(var t=[],e=0;e<this.eIDs.length;e++){var i=s[this.eIDs[e]];i.vIDs[0]===this.$id&&t.push(i.vIDs[1]),i.vIDs[1]===this.$id&&t.push(i.vIDs[0])}return t},t.Graph.UnDirectedE=function(){this.$id=i++,this.data=null,this.vIDs=[],s[this.$id]=this},t.Graph.UnDirectedE.prototype.init=function(t,e){this.vIDs=t,this.data=e}}(o),function(t){function e(t){this.createTime=Date.now(),this.deltaTime=t.deltaTime,this.fps=parseInt(1e3/this.deltaTime),this.frameCount=t.frameAllCount,this.isRendered=!1}t.Ticker=function(e){this.yccClass=t.Ticker,this.yccInstance=e,this.currentFrame=null,this.startTime=Date.now(),this.lastFrameTime=this.startTime,this.lastFrameTickerCount=0,this.deltaTime=0,this.deltaTimeExpect=0,this.deltaTimeRatio=1,this.frameListenerList=[],this.defaultFrameRate=60,this.defaultDeltaTime=1e3/this.defaultFrameRate,this.tickerSpace=1,this.frameAllCount=0,this.timerTickCount=0,this._timerId=0,this._isRunning=!1},t.Ticker.prototype.start=function(t){var i=this.yccInstance.canvasDom.requestAnimationFrame?this.yccInstance.canvasDom.requestAnimationFrame:requestAnimationFrame||webkitRequestAnimationFrame||mozRequestAnimationFrame||oRequestAnimationFrame||msRequestAnimationFrame,r=this;r.currentFrame=null,r.timerTickCount=0,r.lastFrameTickerCount=0,t=t||r.defaultFrameRate,r.tickerSpace=parseInt(60/t)||1,r.deltaTimeExpect=1e3/t,r.frameAllCount=0,r.startTime=Date.now(),r._isRunning||(i||(i=function(t){return setTimeout((function(){t(Date.now())}),1e3/60)}),r._timerId=i((function t(n){r.timerTickCount++,r.timerTickCount-r.lastFrameTickerCount===r.tickerSpace&&(r.frameAllCount++,r.deltaTime=n-r.lastFrameTime,r.deltaTimeRatio=r.deltaTime/r.deltaTimeExpect,r.lastFrameTime+=r.deltaTime,r.lastFrameTickerCount=r.timerTickCount,r.currentFrame=new e(r),r.broadcastFrameEvent(r.currentFrame),r.broadcastToLayer(r.currentFrame)),r._timerId=i(t)})),r._isRunning=!0)},t.Ticker.prototype.stop=function(){var t=this.yccInstance.canvasDom.cancelAnimationFrame?this.yccInstance.canvasDom.cancelAnimationFrame:cancelAnimationFrame||webkitCancelAnimationFrame||mozCancelAnimationFrame||oCancelAnimationFrame;t||(t=function(t){return clearTimeout(t)}),t(this._timerId),this._isRunning=!1,this.currentFrame=null},t.Ticker.prototype.addFrameListener=function(t){this.frameListenerList.push(t)},t.Ticker.prototype.removeFrameListener=function(t){var e=this.frameListenerList.indexOf(t);-1!==e&&this.frameListenerList.splice(e,1)},t.Ticker.prototype.broadcastFrameEvent=function(e){for(var i=0;i<this.frameListenerList.length;i++){var r=this.frameListenerList[i];t.utils.isFn(r)&&r(e)}},t.Ticker.prototype.broadcastToLayer=function(t){for(var e=0;e<this.yccInstance.layerList.length;e++){var i=this.yccInstance.layerList[e];i.show&&i.enableFrameEvent&&i.onFrameComing(t)}}}(o),function(t){t.Debugger=function(e){this.yccClass=t.Debugger,this.yccInstance=e,this.deltaTime=null,this.deltaTimeExpect=null,this.frameAllCount=null,this.deltaTimeAverage=null,this.renderTime=null,this.renderUiCount=null,this.totalJSHeapSize=null,this.usedJSHeapSize=null,this.jsHeapSizeLimit=null,this.fields=[],this.rect=null,this.layer=null},t.Debugger.prototype.init=function(){this.rect=new t.UI.Rect({name:"debuggerRect",rect:new t.Math.Rect(10,10,200,140),color:"rgba(255,255,0,0.5)"}),this.layer=yccInstance.layerManager.newLayer({name:"debug图层"});var e=this;this.yccInstance.ticker.addFrameListener((function(){e.updateInfo()}))},t.Debugger.prototype.showDebugPanel=function(){this.init();var t=this.layer;-1===t.uiList.indexOf(this.rect)&&t.addUI(this.rect)},t.Debugger.prototype.updateInfo=function(){var t=this.yccInstance.layerList,e=t.indexOf(this.layer);-1!==e&&(e+1!==t.length&&(t.splice(e,1),t.push(this.layer)),this.rect.rect.height=20*this.fields.length,this.fields.forEach((function(t){t.ui.content=t.name+" "+t.cb()})))},t.Debugger.prototype.addField=function(e,i){var r=this.fields.length,n=new t.UI.SingleLineText({content:"usedJSHeapSize "+i(),fontSize:"12px",rect:new t.Math.Rect(0,20*r,100,20),color:"green"});this.fields.push({name:e,cb:i,ui:n}),this.rect.addChild(n)},t.Debugger.prototype.addToLayer=function(t){-1===t.uiList.indexOf(this.rect)&&t.addUI(this.rect)},t.Debugger.prototype.updateField=function(t,e){for(var i=0;i<this.fields.length;i++)if(this.fields[i].name===t)return this.fields[i].cb=null,void(this.fields[i].cb=e)},t.Debugger.Log=function(t){this.message="[Ycc logger]=> "+t},t.Debugger.Error=function(t){this.message="[Ycc  error]=> "+t}}(o),function(t){function e(){this.currentTime=0,this.source=null,this.running=!1}t.Loader=function(e){this.yccClass=t.Loader,this.yccInstance=e,this.ajax=new t.Ajax,this.basePath=""},t.Loader.prototype.loadResParallel=function(e,i,r,n,s){function o(o,h,a){return function(){n.push(o),void 0!==o.name&&(s[o.name]=o.res),t.utils.isFn(r)&&r(o,a,h),e.length===n.length&&i(n,s)}}n=n||[],s=s||{};for(var h=0;h<e.length;h++){var a=e[h],c="load";a.type=a.type||"image","image"===a.type&&(a.res=this._createImage(),a.res.src=a.url,a.res.crossOrigin=a.crossOrigin||""),"audio"===a.type&&(c="loadedmetadata",a.res=new Audio,a.res.src=a.url,a.res.preload="load",a.res.crossOrigin=a.crossOrigin||""),a.res["on"+c]=o(a,h,!0),a.res.onerror=o(a,h,!1)}},t.Loader.prototype.loadResOneByOne=function(i,r,n,s,o){function h(){clearTimeout(g),"image"===u.type||"undefined"!=typeof wx&&u.type,s.push(u),void 0!==u.name&&(o[u.name]=u.res),t.utils.isFn(n)&&n(u,null,l),c.loadResOneByOne(i,r,n,s,o)}function a(e){console.log("loader:",u.name,"error"),clearTimeout(g),("image"===u.type||"undefined"!=typeof wx&&"audio"===u.type)&&(u.res.removeEventListener(p,h),u.res.removeEventListener(d,a)),s.push(u),void 0!==u.name&&(o[u.name]=u.res),t.utils.isFn(n)&&n(u,e,l),c.loadResOneByOne(i,r,n,s,o)}if(s=s||[],o=o||{},i.length!==s.length){var c=this,l=s.length,u=i[l],p="load",d="error";u.type=u.type||"image";var g=0;!function(e,i){t.utils.isWx()&&-1!==e.indexOf("cloud://")?wx.cloud.downloadFile({fileID:e,success:function(t){i.call(this,t.tempFilePath)},fail:function(){i.call(this,e)}}):i.call(this,e)}(c.basePath+u.url,(function(t){if("image"===u.type)u.res=c._createImage(),u.res.src=t,u.res["on"+p]=h,u.res["on"+d]=a,g=setTimeout((function(){u.res["on"+p]=null,u.res["on"+d]=null,a({message:"获取资源超时！"})}),u.timeout||1e4);else if("audio"===u.type){if("undefined"!=typeof wx)return u.res=new Audio,u.res.src=t,p="loadedmetadata",d="error",u.res.addEventListener(p,h),void u.res.addEventListener(d,a);if(u.res=new e,!u.res.context)return void a({message:"浏览器不支持AudioContext！"});console.log(t),c.ajax.get(t,function(t){return function(e){t.res.context.decodeAudioData(e,(function(e){t.res.buf=e,h()}),a)}}(u),a,"arraybuffer")}}))}else r(s,o)},t.Loader.prototype.getResByName=function(t,e){for(var i=0;i<e.length;i++)if(e[i].name===t)return e[i];return null},t.Loader.prototype._createImage=function(){return this.yccInstance&&"wxapp"===this.yccInstance.config.appenv?this.yccInstance.canvasDom.createImage():new Image},e.prototype.context="undefined"!=typeof AudioContext&&new AudioContext||"undefined"!=typeof webkitAudioContext&&new webkitAudioContext,e.prototype.play=function(){var t=this.context;if(t){this.running=!0,this.source&&this.source.stop();var e=t.createBufferSource();e.buffer=this.buf,e.connect(t.destination),e.start(this.currentTime),this.source=e}},e.prototype.pause=function(){this.context&&(this.running=!1,this.source.stop(),this.source=null)}}(o),function(t){t.Ajax=function(){this.yccClass=t.Ajax},t.Ajax.prototype.get=function(t){var e,i,r=this,n="",s="json";1===arguments.length?(n="",e=t.successCb,i=t.errorCb,s="json"):(n=arguments[0],e=arguments[1],i=arguments[2],s=arguments[3]);var o=new XMLHttpRequest;o.open("GET",n,!0),o.responseType=s,o.onload=function(){e.call(r,o.response)},o.onerror=function(t){i.call(r,t)},o.send()}}(o),function(t){t.Event=function(e){this.yccClass=t.Event,this.type=e||"",this.x=0,this.y=0,this.originEvent=null,this.stop=!1,this.target=null,t.utils.isObj(e)&&t.utils.extend(this,e)}}(o),function(t){t.Listener=function(){this.yccClass=t.Listener,this.listeners={},this.stopType={},this.disableType={},this.stopAllEvent=!1,this.onclick=null,this.onmousedown=null,this.onmouseup=null,this.onmousemove=null,this.ondragstart=null,this.ondragging=null,this.ondragend=null,this.onmouseover=null,this.onmouseout=null,this.ontouchstart=null,this.ontouchmove=null,this.ontouchend=null,this.ontap=null,this.onzoom=null,this.onrotate=null,this.onmultistart=null,this.onmultichange=null,this.onmultiend=null},t.Listener.release=function(e){var i=null;for(i in e.yccClass=null,e.listeners)e.listeners.hasOwnProperty(i)&&(e.listeners[i].length=0,delete e.listeners[i]);t.utils.releaseObject(e.stopType),t.utils.releaseObject(e.disableType),e.stopAllEvent=!0,e.onclick=null,e.onmousedown=null,e.onmouseup=null,e.onmousemove=null,e.ondragstart=null,e.ondragging=null,e.ondragend=null,e.onmouseover=null,e.onmouseout=null,e.ontouchstart=null,e.ontouchmove=null,e.ontouchend=null,e.ontap=null},t.Listener.prototype.addListener=function(t,e){this.listeners[t]||(this.listeners[t]=[]),-1===this.listeners[t].indexOf(e)&&this.listeners[t].push(e)},t.Listener.prototype.stop=function(t){this.stopType[t]=!0},t.Listener.prototype.triggerListener=function(e,i){if(!this.stopAllEvent&&!this.disableType[e]){this.stopType[e]||t.utils.isFn(this["on"+e])&&this["on"+e].apply(this,Array.prototype.slice.call(arguments,1));var r=this.listeners&&this.listeners[e];if(r&&t.utils.isArray(r))for(var n=0;n<r.length;n++)this.stopType[e]||r[n].apply(this,Array.prototype.slice.call(arguments,1))}},t.Listener.prototype.removeListener=function(e,i){var r=this.listeners[e];if(r&&t.utils.isArray(r))for(var n=0;n<r.length;n++)if(r[n]===i)return void r.splice(n,1)},t.Listener.prototype.disableEvent=function(t){this.disableType[t]=!0},t.Listener.prototype.resumeEvent=function(t){this.disableType[t]=!1}}(o),function(t){var e=function(){var t=0;return function(){this.id=t++,this.startTouchEvent=null,this.endTouchEvent=null,this.moveTouchEventList=[],this.startTime=Date.now(),this.endTime=0}}();t.TouchLifeTracer=function(e){t.Listener.call(this),this.target=e.target,this._lifeList=[],this.currentLifeList=[],this.targetTouches=[],this.touches=[],this.changedTouches=[],this.onlifestart=null,this.onlifechange=null,this.onlifeend=null,this.addLife=function(t){this._lifeList.push(t)},this.findCurrentLifeByTouchID=function(t){for(var e=0;e<this.currentLifeList.length;e++){var i=this.currentLifeList[e];if(i.startTouchEvent.identifier===t)return i}},this.deleteCurrentLifeByTouchID=function(t){for(var e=0;e<this.currentLifeList.length;e++){if(this.currentLifeList[e].startTouchEvent.identifier===t)return this.currentLifeList.splice(e,1),!0}return!1},this.init=function(){return this.target.addEventListener?(this.target.addEventListener("touchstart",this.touchstart.bind(this)),this.target.addEventListener("touchmove",this.touchmove.bind(this)),void this.target.addEventListener("touchend",this.touchend.bind(this))):console.error("addEventListener undefined")},this.init()},t.TouchLifeTracer.prototype.touchstart=function(t){console.log("touchstart",t);var i=this;t.preventDefault&&t.preventDefault(),i.syncTouches(t);var r=new e;r.startTouchEvent=t.changedTouches[0],i.addLife(r),i.currentLifeList.push(r),i.triggerListener("lifestart",r)},t.TouchLifeTracer.prototype.touchmove=function(t){var e=this;t.preventDefault&&t.preventDefault(),e.syncTouches(t);for(var i=t.changedTouches,r=0;r<i.length;r++){var n=i[r],s=e.findCurrentLifeByTouchID(n.identifier),o=e.indexOfTouchFromMoveTouchEventList(s.moveTouchEventList,n);-1===o?s.moveTouchEventList.push(n):s.moveTouchEventList[o]=n,e.triggerListener("lifechange",s)}},t.TouchLifeTracer.prototype.touchend=function(t){var e=this;t.preventDefault&&t.preventDefault(),e.syncTouches(t);var i=t.changedTouches[0],r=e.findCurrentLifeByTouchID(i.identifier);r.endTouchEvent=i,r.endTime=Date.now(),e.deleteCurrentLifeByTouchID(i.identifier),e.triggerListener("lifeend",r)},t.utils.mergeObject(t.TouchLifeTracer.prototype,t.Listener.prototype),t.TouchLifeTracer.prototype.syncTouches=function(t){this.touches=[],this.changedTouches=[],this.targetTouches=[];var e=0,i=[];for(i=t.touches,e=0;e<i.length;e++)i[e].pageX=i[e].pageX||i[e].x,i[e].pageY=i[e].pageY||i[e].y,i[e].clientX=i[e].clientX||i[e].x,i[e].clientY=i[e].clientY||i[e].y,this.touches.push(i[e]);for(i=t.changedTouches,e=0;e<i.length;e++)i[e].pageX=i[e].pageX||i[e].x,i[e].pageY=i[e].pageY||i[e].y,i[e].clientX=i[e].clientX||i[e].x,i[e].clientY=i[e].clientY||i[e].y,this.changedTouches.push(i[e]);for(i=t.targetTouches||t.touches,e=0;e<i.length;e++)i[e].pageX=i[e].pageX||i[e].x,i[e].pageY=i[e].pageY||i[e].y,i[e].clientX=i[e].clientX||i[e].x,i[e].clientY=i[e].clientY||i[e].y,this.targetTouches.push(i[e])},t.TouchLifeTracer.prototype.indexOfTouchFromMoveTouchEventList=function(t,e){for(var i=0;i<t.length;i++)if(e.identifier===t[i].identifier)return i;return-1}}(o),function(t){t.Gesture=function(e){t.Listener.call(this),this.yccClass=t.Gesture,e=e||{},this.option={target:null,useMulti:!0},t.utils.extend(this.option,e),this._longTapTimeout=null,this.ismutiltouching=!1,this.touchLifeTracer=null,this._init()},t.Gesture.prototype=new t.Listener,t.Gesture.prototype._init=function(){t.utils.isMobile()?(console.log("mobile gesture init..."),this._initForMobile()):(console.log("pc gesture init..."),this._initForPC())},t.Gesture.prototype._initForMobile=function(){var e=this,i=new t.TouchLifeTracer({target:this.option.target});this.touchLifeTracer=i;var r,n,s={tap:!1,swipe:!1};i.onlifestart=function(t){if(e.triggerListener("tap",e._createEventData(t.startTouchEvent,"tap")),e.triggerListener("log","tap triggered"),e.triggerListener("dragstart",e._createEventData(t.startTouchEvent,"dragstart")),i.currentLifeList.length>1){if(e.ismutiltouching=!0,!e.option.useMulti)return;return e.triggerListener("log","multi touch start ..."),e.triggerListener("multistart",i.currentLifeList),s.tap=!1,s.swipe=!1,clearTimeout(this._longTapTimeout),r=i.currentLifeList[0],n=i.currentLifeList[1],this}e.ismutiltouching=!1,s.tap=!1,s.swipe=!1,this._longTapTimeout=setTimeout((function(){e.triggerListener("longtap",e._createEventData(t.startTouchEvent,"longtap"))}),750)},i.onlifechange=function(o){if(o.moveTouchEventList.forEach((function(t){e.triggerListener("dragging",e._createEventData(t,"dragging"))})),i.currentLifeList.length>1){if(e.ismutiltouching=!0,!e.option.useMulti)return;s.tap=!0,s.swipe=!0,e.triggerListener("log","multi touch move ..."),e.triggerListener("multichange",r,n);var h,a=e.getZoomRateAndRotateAngle(r,n);if(t.utils.isNum(a.rate))(h=e._createEventData(r.startTouchEvent,"zoom")).zoomRate=a.rate,e.triggerListener("zoom",e._createEventData(h,"zoom")),e.triggerListener("log","zoom triggered",a.rate);if(t.utils.isNum(a.angle))(h=e._createEventData(r.startTouchEvent,"rotate")).angle=a.angle,e.triggerListener("rotate",e._createEventData(h,"rotate")),e.triggerListener("log","rotate triggered",a.angle);return this}if(o.moveTouchEventList.length>0){e.ismutiltouching=!1;var c=o.startTouchEvent,l=Array.prototype.slice.call(o.moveTouchEventList,-1)[0];(Math.abs(l.pageX-c.pageX)>10||Math.abs(l.pageY-c.pageY)>10)&&(s.tap=!0,clearTimeout(this._longTapTimeout))}},i.onlifeend=function(t){if(e.triggerListener("dragend",e._createEventData(t.endTouchEvent,"dragend")),e.ismutiltouching=!0,1===i.currentLifeList.length)return e.ismutiltouching=!1,e.triggerListener("multiend",r,n);if(0===i.currentLifeList.length){if(e.ismutiltouching=!1,!s.tap&&t.endTime-t.startTime<300)return clearTimeout(this._longTapTimeout),r&&t.endTime-r.endTime<300&&Math.abs(r.endTouchEvent.pageX-t.endTouchEvent.pageX)<10&&Math.abs(r.endTouchEvent.pageY-t.endTouchEvent.pageY)<10?(e.triggerListener("doubletap",e._createEventData(t.endTouchEvent,"doubletap")),e.triggerListener("log","doubletap triggered"),r=null,this):(r=t,this);if(!s.swipe&&t.endTime-t.startTime<300){var o=t.startTouchEvent,h=Array.prototype.slice.call(t.moveTouchEventList,-1)[0];if(Math.abs(h.pageX-o.pageX)>30||Math.abs(h.pageY-o.pageY)>30){var a=e._getSwipeDirection(o.pageX,o.pageY,h.pageX,h.pageY),c="swipe"+a;e.triggerListener("log",c),t.endTouchEvent.swipeDirection=a,e.triggerListener(c,e._createEventData(t.endTouchEvent,c)),e.triggerListener("swipe",e._createEventData(t.endTouchEvent,"swipe")),console.log("swipe",c)}return this}}}},t.Gesture.prototype._initForPC=function(){var t=this,e=null,i=null,r=!1,n=null,s=-1,o=0;this.option.target.addEventListener("mousedown",(function(i){i.identifier=++o,e=t._createEventData(i),s=setTimeout((function(){console.log("longtap",Date.now(),"..."),t.triggerListener("log","long tap ..."),t.triggerListener("longtap",t._createEventData(e,"longtap"))}),750)})),this.option.target.addEventListener("mousemove",(function(n){if(t.triggerListener("mousemove",t._createEventData(n,"mousemove")),e){if(e&&n.clientX===e.clientX&&n.clientY===e.clientY)return;if(i&&n.clientX===e.clientX&&n.clientY===e.clientY)return;clearTimeout(s),r||(t.triggerListener("dragstart",t._createEventData(e,"dragstart")),r=!0),n.identifier=o,t.triggerListener("dragging",t._createEventData(n,"dragging"))}else clearTimeout(s)})),this.option.target.addEventListener("mouseup",(function(h){if(h.identifier=o,i=t._createEventData(h),r){if(clearTimeout(s),t.triggerListener("dragend",t._createEventData(h,"dragend")),r&&i.createTime-e.createTime<300&&(Math.abs(i.pageX-e.pageX)>30||Math.abs(i.pageY-e.pageY)>30)){var a=t._getSwipeDirection(e.pageX,e.pageY,i.pageX,i.pageY),c="swipe"+a;t.triggerListener("log",c),e.swipeDirection=a,t.triggerListener(c,t._createEventData(e,c)),t.triggerListener("swipe",t._createEventData(e,"swipe")),console.log("swipe",c)}return r=!1,e=null,null}if(!r&&e&&i.createTime-e.createTime<300){clearTimeout(s);var l=t._createEventData(e,"tap");return t.triggerListener("tap",l),t.triggerListener("log","tap triggered"),n&&l.createTime-n.createTime<300&&Math.abs(n.pageX-l.pageX)<10&&Math.abs(n.pageY-l.pageY)<10?(t.triggerListener("doubletap",t._createEventData(l,"doubletap")),t.triggerListener("log","doubletap triggered"),n=null,this):(n=l,e=null,this)}}))},t.Gesture.prototype._createEventData=function(e,i){var r={type:"",target:null,identifier:-1,x:0,y:0,clientX:0,clientY:0,pageX:0,pageY:0,screenX:0,screenY:0,force:1,swipeDirection:"",zoomRate:1,angle:0,createTime:Date.now()};return(r=t.utils.extend(r,e)).type=i,r},t.Gesture.prototype._getSwipeDirection=function(t,e,i,r){return Math.abs(t-i)>=Math.abs(e-r)?t-i>0?"left":"right":e-r>0?"up":"down"},t.Gesture.prototype.getZoomRateAndRotateAngle=function(e,i){this.triggerListener("log","preLife"),this.triggerListener("log",e),this.triggerListener("log","curLife"),this.triggerListener("log",i);var r=e.startTouchEvent.pageX,n=e.startTouchEvent.pageY,s=i.startTouchEvent.pageX,o=i.startTouchEvent.pageY,h=e.moveTouchEventList.length>0?e.moveTouchEventList[e.moveTouchEventList.length-1]:e.startTouchEvent,a=i.moveTouchEventList.length>0?i.moveTouchEventList[i.moveTouchEventList.length-1]:i.startTouchEvent,c=h.pageX,l=h.pageY,u=a.pageX,p=a.pageY,d=new t.Math.Vector(s-r,o-n),g=new t.Math.Vector(u-c,p-l),y=Math.acos(g.dot(d)/(g.getLength()*d.getLength()))/Math.PI*180;return{rate:g.getLength()/d.getLength(),angle:y*(g.cross(d).z>0?-1:1)}},t.Gesture.prototype.enableMutiTouch=function(t){this.option.useMulti=!1}}(o),function(t){var e=0;t.Layer=function(i,r){t.Listener.call(this),r=r||{},this.yccClass=t.Layer,this.uiList=[],this.uiCountRecursion=0,this.uiCountRendered=0,this.yccInstance=i,this.ctx=null,this.useCache=!1,this.ctxCache=null,this.ctxCacheRect=null,this.renderCacheRect=!1,this.id=e++,this.type="ui",this.textValue="",this.name=r.name?r.name:"图层_"+this.type+"_"+this.id,this.x=0,this.y=0,this.width=i.getStageWidth(),this.height=i.getStageHeight(),this.show=!0,this.ghost=!1,this.enableEventManager=!1,this.enableFrameEvent=!1,this.onFrameComing=function(){},t.utils.extend(this,r),this.init()},t.Layer.prototype=new t.Listener,t.Layer.prototype.constructor=t.Layer,t.Layer.release=function(e){t.Listener.release(e),e.yccClass=null,e.uiList=null,e.yccInstance=null,e.show=!1,e.enableEventManager=!1,e.enableFrameEvent=!1,e.onFrameComing=null},t.Layer.prototype.init=function(){this.ctx=this.yccInstance.ctx,this.ctxCache=this.useCache?this.yccInstance.createCacheCtx({width:this.width*this.yccInstance.dpi,height:this.height*this.yccInstance.dpi}):this.ctx,this._setCtxProps()},t.Layer.prototype._initEvent=function(){function e(e){if(!e.stop)for(var s=i.uiList.length-1;s>=0;s--){var o=i.uiList[s],h=new t.Math.Dot(e.x,e.y);if(o.rect&&h.isInRect(o.getAbsolutePosition())&&!1===e.stop){e.stop=!0,e.mouseDownYccEvent=r,e.mouseUpYccEvent=n,e.target=o,e.targetDeltaPosition=new t.Math.Dot(e.x-o.getAbsolutePosition().x,e.y-o.getAbsolutePosition().y),o.triggerListener(e.type,e);break}}}var i=this,r=null,n=null,s=!1,o=!1;this.addListener("click",(function(t){s||e(t)})),this.addListener("mousedown",(function(t){s=!1,o=!1,r=t,e(t)})),this.addListener("mouseup",(function(s){if(o){var h=new t.Event({type:"dragend",x:s.x,y:s.y,mouseDownYccEvent:r});i.triggerListener("dragend",h),r&&r.target&&(i.target=r.target,i.target.triggerListener("dragend",h))}s.mouseDownYccEvent=r=null,n=s,e(s)})),this.addListener("mousemove",(function(e){if(!e.stop&&!(r&&e.x===r.x&&e.y===r.y||n&&e.x===n.x&&e.y===n.y)){if(s=!0,r){if(!o){var h=new t.Event({type:"dragstart",x:r.x,y:r.y,mouseDownYccEvent:r});i.triggerListener(h.type,h),r.target&&(h.target=r.target,h.target.triggerListener(h.type,h))}o=!0;var a=new t.Event({type:"dragging",x:e.x,y:e.y,mouseDownYccEvent:r});return i.triggerListener(a.type,a),r.target&&(a.target=r.target,a.target.triggerListener(a.type,a)),null}for(var c=i.uiList.length-1;c>=0;c--){var l=i.uiList[c];if(new t.Math.Dot(e.x-l.belongTo.x,e.y-l.belongTo.y).isInRect(l.rect)){e.stop=!0,e.mouseDownYccEvent=r,e.mouseUpYccEvent=n,e.target=l,l.triggerListener(e.type,e);break}}}}))},t.Layer.prototype._setCtxProps=function(e,i){i=i||this.ctx;var r={fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",fontSize:"16px",fontFamily:"微软雅黑",font:"16px 微软雅黑",textBaseline:"hanging",fillStyle:"red",strokeStyle:"blue"};for(var n in(r=t.utils.extend(r,e)).fontSize=parseInt(r.fontSize)*this.yccInstance.getSystemInfo().devicePixelRatio+"px",r.font=[r.fontStyle,r.fontVariant,r.fontWeight,r.fontSize,r.fontFamily].join(" "),r)r.hasOwnProperty(n)&&(i[n]=r[n])},t.Layer.prototype.clear=function(){this.ctx.clearRect(0,0,this.width,this.height)},t.Layer.prototype.removeAllUI=function(){this.uiList.forEach((function(e){t.UI.release(e)})),this.uiList.length=0,this.updateCache()},t.Layer.prototype.removeSelf=function(){this.removeAllUI(),this.yccInstance.layerManager.deleteLayer(this),t.Layer.release(this)},t.Layer.prototype.renderToStage=function(){this.show&&this.yccInstance.ctx.drawImage(this.ctx.canvas,0,0,this.width,this.height)},t.Layer.prototype.addUI=function(t,e){var i=this;t.itor().each((function(t){t.init(i)}));var r=this.uiList.indexOf(e);return e&&-1!==r?(this.uiList.splice(r,0,t),t._onAdded&&t._onAdded(),this.updateCache(),t):(this.uiList.push(t),t._onAdded&&t._onAdded(),t)},t.Layer.prototype.removeUI=function(e){if(!e)return!1;var i=this.uiList.indexOf(e);return-1!==i&&(t.UI.release(e),this.uiList[i]=null,this.uiList.splice(i,1),this.updateCache(),!0)},t.Layer.prototype.render=function(t){this.reRender(t)},t.Layer.prototype.reRender=function(t){if(this.show)return this.useCache?this.renderCacheToStage(t):void this.renderAllToCtx(this.ctx)},t.Layer.prototype.renderCacheToStage=function(t){if(this.useCache){t&&this.updateCache();var e=this.yccInstance.dpi;if(this.ctxCacheRect){var i=this.ctxCacheRect.x*e,r=this.ctxCacheRect.y*e,n=this.ctxCacheRect.width*e,s=this.ctxCacheRect.height*e;this.ctx.drawImage(this.ctxCache.canvas,i,r,n,s,i,r,n,s)}else this.ctx.drawImage(this.ctxCache.canvas,0,0);this.ctx.draw&&this.ctx.draw()}},t.Layer.prototype.getUIFromPointer=function(e,i){i=!t.utils.isBoolean(i)||i;for(var r=null,n=0,s=0;s<this.uiList.length;s++){var o=this.uiList[s];i&&!o.show||this.uiList[s].itor().depthDown((function(t,s){return t.ghost||i&&!t.show?-1:void(t.containDot(e)&&s>=n&&(r=t,n=s))}))}return r},t.Layer.prototype.getUIListFromPointer=function(t){for(var e=[],i=0;i<this.uiList.length;i++)this.uiList[i].itor().depthDown((function(i,r){i.containDot(t)&&e.push(i)}));return e},t.Layer.prototype.transformToAbsolute=function(e){var i=null;if(t.utils.isArray(e)){i=[];for(var r=0;r<e.length;r++){var n=new t.Math.Dot(0,0),s=e[r];n.x=this.x+s.x,n.y=this.y+s.y,i.push(n)}return i}return(i=new t.Math.Dot(0,0)).x=this.x+e.x,i.y=this.y+e.y,i},t.Layer.prototype.transformToLocal=function(e){var i=null;if(t.utils.isArray(e)){i=[];for(var r=0;r<e.length;r++){var n=new t.Math.Dot(0,0),s=e[r];n.x=s.x-this.x,n.y=s.y-this.y,i.push(n)}return i}return(i=new t.Math.Dot(0,0)).x=e.x-this.x,i.y=e.y-this.y,i},t.Layer.prototype.renderAllToCtx=function(t){var e=this;e.uiCountRecursion=0,e.uiCountRendered=0;for(var i=0;i<this.uiList.length;i++)this.uiList[i].show&&(this.uiList[i].itor().depthDown((function(t,i){if(e.uiCountRecursion++,!t.show)return-1;var r=t.__render();e.useCache&&e._mergeCtxCacheRect(t.getAbsolutePositionRect()),r||e.uiCountRendered++})),this.uiList[i]._onChildrenRendered&&this.uiList[i]._onChildrenRendered());var r=this.ctxCacheRect;if(this.useCache&&r&&this.renderCacheRect){var n=this.yccInstance.dpi,s=this.yccInstance.getStageWidth()/n,o=this.yccInstance.getStageHeight()/n,h=r.x<0?0:r.x,a=r.y<0?0:r.y,c=r.width>s?s:r.width,l=r.height>o?o:r.height;t.save(),t.beginPath(),t.strokeStyle="red",t.strokeWidth=2,t.rect(h*n,a*n,c*n,l*n),t.closePath(),t.stroke(),t.restore()}t.draw&&t.draw()},t.Layer.prototype._mergeCtxCacheRect=function(e){var i=this.yccInstance;if(!this.ctxCacheRect)return this.ctxCacheRect=new t.Math.Rect(e);var r=i.getStageWidth(),n=i.getStageHeight(),s=i.dpi,o=this.ctxCacheRect,h=o.x+o.width,a=o.y+o.height,c=e.x+e.width,l=e.y+e.height;return o.x=o.x<e.x?o.x:e.x,o.y=o.y<e.y?o.y:e.y,o.width=h<c?c-o.x:h-o.x,o.height=a<l?l-o.y:a-o.y,o.x=o.x<0?0:o.x,o.y=o.y<0?0:o.y,o.width=o.x+o.width>r/s?r/s-o.x:o.width,o.height=o.y+o.height>n/s?n/s-o.y:o.height,o},t.Layer.prototype.updateCache=function(){this.useCache&&(this.clearCache(),this.renderAllToCtx(this.ctxCache))},t.Layer.prototype.clearCache=function(){var t=this.ctxCache.canvas.width;this.ctxCache.canvas.width=t,this.ctxCacheRect=null}}(o),function(t){t.LayerManager=function(t){this.yccInstance=t,this.renderTime=0,this.maxRenderTime=0,this.renderUiCount=0},t.LayerManager.prototype.init=function(){},t.LayerManager.prototype.newLayer=function(e){var i=new t.Layer(this.yccInstance,e);return this.yccInstance.layerList.push(i),i},t.LayerManager.prototype.deleteLayer=function(t){for(var e=this.yccInstance.layerList,i=0;i<e.length;i++)if(e[i].id===t.id)return this.yccInstance.layerList.splice(i,1),t;return t},t.LayerManager.prototype.deleteAllLayer=function(){for(var e=0;e<this.yccInstance.layerList.length;e++){var i=this.yccInstance.layerList[e];i.removeAllUI(),t.Layer.release(i),i=null}this.yccInstance.layerList=[]},t.LayerManager.prototype.reRenderAllLayerToStage=function(t){var e=this.yccInstance;if(e.ticker.currentFrame&&e.ticker.currentFrame.isRendered)return console.log("stop overdraw!");var i=Date.now();this.renderUiCount=0,this.yccInstance.clearStage();for(var r=0;r<this.yccInstance.layerList.length;r++){var n=this.yccInstance.layerList[r];n.show&&(n.reRender(t),this.renderUiCount+=n.uiCountRendered)}this.renderTime=Date.now()-i,this.maxRenderTime=this.renderTime>this.maxRenderTime?this.renderTime:this.maxRenderTime,e.ticker.currentFrame&&(e.ticker.currentFrame.isRendered=!0)},t.LayerManager.prototype.enableEventManagerOnly=function(t){if(!t)return!1;for(var e=0;e<this.yccInstance.layerList.length;e++)this.yccInstance.layerList[e].enableEventManager=!1;return t.enableEventManager=!0,this},t.LayerManager.prototype.enableEventManagerAll=function(t){for(var e=0;e<this.yccInstance.layerList.length;e++)this.yccInstance.layerList[e].enableEventManager=t;return this},t.LayerManager.prototype.renderAllLayerByJsonArray=function(e){if(!t.utils.isArray(e))return console.error("jsonArray is not an Array!",e);for(var i=0;i<e.length;i++){var r=e[i];if(!t.utils.isObj(r))return console.error("item in jsonArray should be an Object!",r);for(var n=this.newLayer(r.option),s=0;s<r.ui.length;s++){var o=r.ui[s];n.addUI(new t.UI[o.type](o.option))}n.render()}}}(o),function(t){var e=function(t){this.imageData=t,this.createTime=new Date,this.id=this.createTime.getTime()};t.PhotoManager=function(t){this.yccInstance=t,this.ctx=t.ctx,this._photos=[]},t.PhotoManager.prototype.takePhoto=function(){return this._photos.push(new e(this.ctx.getImageData(0,0,this.yccInstance.getStageWidth(),this.yccInstance.getStageHeight()))),this},t.PhotoManager.prototype.getHistoryPhotos=function(){return this._photos},t.PhotoManager.prototype.showPhoto=function(t){return this.ctx.putImageData(t.imageData,0,0),t},t.PhotoManager.prototype.showLastPhoto=function(){var t=this._photos.length,e=!1;return t>=1&&(e=this._photos[t-1],this.showPhoto(e)),e},t.PhotoManager.prototype.delPhotoById=function(t){for(var e=this._photos.slice(0),i=0;i<e.length;i++)if(e[i].id===t)return e.splice(i+1,1),this._photos=e,e[i];return!1}}(o),function(t){if(!t||!t.utils)return console.error("Error: Ycc.ui needs module `Ycc` and `Ycc.utils`!");t.utils.isObj,t.utils.isArray,t.utils.isString,t.utils.isNum,t.utils.extend,t.UI=function(e){this.yccClass=t.UI,this._photos=[],this.ctx=e.ctx,this.ctxWidth=e.getStageWidth(),this.ctxHeight=e.getStageHeight()},t.UI.prototype.text=function(t,e,i){return this.ctx.save(),i?this.ctx.fillText(e,t[0],t[1]):this.ctx.strokeText(e,t[0],t[1]),this.ctx.restore(),this},t.UI.prototype.line=function(t,e){return this.ctx.save(),this.ctx.beginPath(),this.ctx.moveTo(t[0],t[1]),this.ctx.lineTo(e[0],e[1]),this.ctx.stroke(),this.ctx.closePath(),this.ctx.restore(),this},t.UI.prototype.rect=function(t,e,i){return this.ctx.save(),this.ctx.beginPath(),this.ctx.rect(t[0],t[1],e[0]-t[0],e[1]-t[1]),this.ctx.closePath(),i?this.ctx.fill():this.ctx.stroke(),this.ctx.restore(),this},t.UI.prototype.ellipse=function(t,e,i,r,n){this.ctx.save();var s=e>i?e:i,o=e/s,h=i/s;return this.ctx.translate(t[0],t[1]),this.ctx.rotate(parseInt(r)*Math.PI/180),this.ctx.translate(-t[0],-t[1]),this.ctx.scale(o,h),this.ctx.beginPath(),this.ctx.arc(t[0]/o,t[1]/h,s,0,2*Math.PI,!1),this.ctx.closePath(),n?this.ctx.fill():this.ctx.stroke(),this.ctx.restore(),this},t.UI.prototype.circleArc=function(t,e,i,r,n){return this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(t[0],t[1],e,i/180*Math.PI,r/180*Math.PI,n),this.ctx.stroke(),this.ctx.closePath(),this.ctx.restore(),this},t.UI.prototype.sector=function(t,e,i,r,n,s){return this.ctx.save(),this.ctx.beginPath(),this.ctx.lineTo(t[0],t[1]),this.ctx.arc(t[0],t[1],e,i*Math.PI/180,r*Math.PI/180,s),this.ctx.lineTo(t[0],t[1]),this.ctx.closePath(),n?this.ctx.fill():this.ctx.stroke(),this.ctx.restore(),this},t.UI.prototype.foldLine=function(t){if(t.length<2)return console.error("Error: 参数错误！");this.ctx.save(),this.ctx.beginPath(),this.ctx.moveTo(t[0][0],t[0][1]);for(var e=0;e<t.length;e++)this.ctx.lineTo(t[e][0],t[e][1]);return this.ctx.stroke(),this.ctx.restore(),this},t.UI.prototype.circle=function(t,e,i){return this.ellipse(t,e,e,0,i),this},t.UI.prototype.image=function(t,e){var i=this;return e=e||[0,0],i.ctx.save(),i.ctx.beginPath(),i.ctx.drawImage(t,e[0],e[1]),i.ctx.closePath(),i.ctx.restore(),this},t.UI.prototype._getMaxLenContent=function(t,e){var i=t;if(this.ctx.measureText(t).width<=e)return t;for(var r=0;r<t.length;r++)if(i=t.slice(0,r),this.ctx.measureText(i).width>e)return t.slice(0,r-1)},t.UI.prototype.scale=function(t,e){return this.ctx.scale(t,e),this},t.UI.prototype.clear=function(){return this.ctx.fillStyle="#fff",this.ctx.save(),this.ctx.beginPath(),this.ctx.rect(0,0,this.ctxWidth,this.ctxHeight),this.ctx.fill(),this.ctx.closePath(),this.ctx.restore(),this}}(o),function(t){var e=0,i=1;t.UI.Base=function(i){t.Listener.call(this),t.Tree.call(this),this.yccClass=t.UI.Base,this.id=e++,this.name="",this.ctx=null,this.ctxCache=null,this.dpi=1,this.rect=new t.Math.Rect,this.x=0,this.y=0,this.anchorX=0,this.anchorY=0,this.rotation=0,this.rectBgColor="rgba(0,0,0,0)",this.rectBorderWidth=0,this.rectBorderColor="#000",this.show=!0,this.ghost=!1,this.stopEventBubbleUp=!0,this.opacity=1,this.lineWidth=1,this.fillStyle="black",this.strokeStyle="black",this.belongTo=null,this.userData=null,this.isShowRotateBeforeUI=!1,this.baseUI=null,this._beforeInit=null,this._afterInit=null,this._onAdded=null,this._onChildrenRendered=null,this.oncomputestart=null,this.oncomputeend=null,this.onrenderstart=null,this.onrenderend=null,this.extend(i)},t.utils.mergeObject(t.UI.Base.prototype,t.Listener.prototype),t.utils.mergeObject(t.UI.Base.prototype,t.Tree.prototype),t.UI.Base.prototype.init=function(e){t.utils.isFn(this._beforeInit)&&this._beforeInit(),this.belongTo=e,this.ctx=e.ctx,this.ctxCache=this.belongTo.ctxCache,this.dpi=this.belongTo.yccInstance.getSystemInfo().devicePixelRatio,t.utils.isFn(this._afterInit)&&this._afterInit()},t.UI.Base.prototype.computeUIProps=function(){},t.UI.Base.prototype.renderRectBgColor=function(){var e=this.getAbsolutePositionPolygon();if(!e||0===e.length)return console.log(new t.Debugger.Log("no polygon coordirates!").message);var i=this.ctxCache;i.save(),i.fillStyle=this.rectBgColor,i.beginPath(),i.moveTo(e[0].x*this.dpi,e[0].y*this.dpi);for(var r=1;r<e.length-1;r++)i.lineTo(e[r].x*this.dpi,e[r].y*this.dpi);i.closePath(),i.fill(),i.restore()},t.UI.Base.prototype.renderRectBorder=function(){if(!(this.rectBorderWidth<=0)){var e=this.getAbsolutePositionPolygon();if(!e||0===e.length)return console.log(new t.Debugger.Log("no polygon coordirates!").message);var i=this.ctxCache;i.save(),i.setLineDash&&i.setLineDash([0]),i.strokeStyle=this.rectBorderColor,i.lineWidth=this.rectBorderWidth,i.beginPath(),i.moveTo(e[0].x*this.dpi,e[0].y*this.dpi);for(var r=1;r<e.length-1;r++)i.lineTo(e[r].x*this.dpi,e[r].y*this.dpi);i.closePath(),i.stroke(),i.restore()}},t.UI.Base.prototype.renderDashBeforeUI=function(t){},t.UI.Base.prototype.removeSelf=function(){this.belongTo.removeUI(this)},t.UI.Base.prototype.addChild=function(t){return this.belongTo&&t.init(this.belongTo),this.addChildTree(t),t},t.UI.Base.prototype.removeChild=function(e){return this.removeChildTree(e),t.UI.release(e),this},t.UI.Base.prototype.scaleAndRotate=function(){var t=this.getAbsolutePositionRect();this.ctx.translate(this.anchorX+t.x,this.anchorY+t.y),this.ctx.rotate(this.rotation*Math.PI/180),this.ctx.translate(-this.anchorX-t.x,-this.anchorY-t.y)},t.UI.Base.prototype.isOutOfStage=function(){var t=this.belongTo.yccInstance.getStageWidth(),e=this.belongTo.yccInstance.getStageHeight(),i=this.getAbsolutePositionRect();return i.x>t||i.x+i.width<0||i.y>e||i.y+i.height<0},t.UI.Base.prototype.isOutOfRect=function(t){var e=t.x,i=t.y,r=t.width,n=t.height,s=this.getAbsolutePositionRect();return s.x>r||s.x+s.width<e||s.y>n||s.y+s.height<i},t.UI.release=function(e){e.itor().leftChildFirst((function(e){e.yccClass!==t.UI.Image&&e.yccClass!==t.UI.ImageFrameAnimation||(e.res=null),t.Tree.release(e),t.Listener.release(e),e.yccInstance=null,e.yccClass=null,e.ctx=null,e.belongTo=null,e.userData=null,e.baseUI=null,e._beforeInit=null,e._afterInit=null,e.oncomputestart=null,e.oncomputeend=null,e.onrenderstart=null,e.onrenderend=null}))},t.UI.Base.prototype.render=function(){},t.UI.Base.prototype._renderContainer=function(t){var e=t,i=this.ctxCache;i.save(),i.beginPath(),i.strokeStyle="#ff0000",i.rect(e.x*this.dpi,e.y*this.dpi,e.width*this.dpi,e.height*this.dpi),i.closePath(),i.stroke(),i.restore(),e=null},t.UI.Base.prototype.__render=function(){this.triggerListener("computestart",new t.Event("computestart"));var e=this.computeUIProps();if(this.triggerListener("computeend",new t.Event("computeend")),e)return e;if(!this.belongTo.useCache&&this.isOutOfStage())return{message:"UI超出舞台！"};if(this.belongTo.useCache&&this.isOutOfRect(new t.Math.Rect(0,0,this.ctxCache.canvas.width*this.dpi,this.ctxCache.canvas.height*this.dpi)))return{message:"UI超出离屏Canvas！"};this._processBeforeRender();var i=this.getAbsolutePositionRect();this.renderRectBgColor(i),this.renderRectBorder(i),this.renderDashBeforeUI(this.ctxCache),this.belongTo.yccInstance.config.debugDrawContainer&&this._renderContainer(i),this.render(),this._processAfterRender()},t.UI.Base.prototype._processBeforeRender=function(){this.triggerListener("renderstart",new t.Event("renderstart")),i=this.ctx.globalAlpha,this.ctx.globalAlpha=this.opacity},t.UI.Base.prototype._processAfterRender=function(){this.ctx.globalAlpha=i,this.triggerListener("renderend",new t.Event("renderend"))},t.UI.Base.prototype.getMaxContentInWidth=function(t,e){var i=t,r=this.ctxCache;if(r.measureText(t).width<=e)return t;for(var n=0;n<t.length;n++)if(i=t.slice(0,n+1),r.measureText(i).width>e)return t.slice(0,n)},t.UI.Base.prototype.extend=function(t){for(var e in t=t||{},this)void 0!==t[e]&&(this[e]=t[e]);return this},t.UI.Base.prototype.clone=function(){var t=new this.yccClass;return t.extend(this),t},t.UI.Base.prototype.getAbsolutePositionPolygon=function(){},t.UI.Base.prototype.getAbsolutePositionRect=function(){var e=this.getAbsolutePosition();return new t.Math.Rect(e.x,e.y,this.rect.width,this.rect.height)},t.UI.Base.prototype.getAbsolutePosition=function(){var e=new t.Math.Rect,i=this.getParent();if(e.width=this.rect.width,e.height=this.rect.height,i){var r=i.getAbsolutePosition();e.x=this.rect.x+r.x,e.y=this.rect.y+r.y}else e.x=this.rect.x+this.belongTo.x,e.y=this.rect.y+this.belongTo.y;return e},t.UI.Base.prototype.transformToAbsolute=function(e){var i=this;if(t.utils.isArray(e))return e.map((function(t){return i.transformToAbsolute(t)}));var r=this.getParent();if(r){var n=r.getAbsolutePosition();return new t.Math.Dot(e.x+n.x,e.y+n.y)}return new t.Math.Dot(e.x+this.belongTo.x,e.y+this.belongTo.y)},t.UI.Base.prototype.transformToLocal=function(e){var i=null,r=this.getAbsolutePosition();if(t.utils.isArray(e)){i=[];for(var n=0;n<e.length;n++){var s=new t.Math.Dot(0,0),o=e[n];s.x=o.x-r.x+this.x,s.y=o.y-r.y+this.y,i.push(s)}return i}return(i=new t.Math.Dot(0,0)).x=e.x-r.x+this.x,i.y=e.y-r.y+this.y,i},t.UI.Base.prototype.containDot=function(t){return t.isInRect(this.getAbsolutePosition())},t.UI.Base.prototype.getDeepLevel=function(){return this.getParentList().length+1},t.UI.Base.prototype.transformByRotate=function(e){var i=this;if(t.utils.isArray(e))return e.map((function(t){return i.transformByRotate(t)}));new t.Math.Dot;var r=(this.getAbsolutePosition(),e.x),n=e.y,s=(r-this.anchorX)*Math.cos(this.rotation/180*Math.PI)-(n-this.anchorY)*Math.sin(this.rotation/180*Math.PI)+this.anchorX,o=(n-this.anchorY)*Math.cos(this.rotation/180*Math.PI)+(r-this.anchorX)*Math.sin(this.rotation/180*Math.PI)+this.anchorY;return this.transformToAbsolute({x:s,y:o})},t.UI.Base.prototype._setCtxProps=function(e,i){i=i||this.ctxCache;var r={fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",fontSize:"16px",fontFamily:"微软雅黑",font:"16px 微软雅黑",textBaseline:"hanging",fillStyle:"red",strokeStyle:"blue"};for(var n in(r=t.utils.extend(r,e)).fontSize=parseInt(r.fontSize)*this.dpi+"px",r.font=[r.fontStyle,r.fontVariant,r.fontWeight,r.fontSize,r.fontFamily].join(" "),r)r.hasOwnProperty(n)&&(i[n]=r[n])},t.UI.Base.prototype.triggerUIEventBubbleUp=function(e,i,r,n){var s=this,o=[];if(s&&s.belongTo&&s.belongTo.enableEventManager){if(s.triggerListener(e,new t.Event({x:i,y:r,type:e,target:s,originEvent:n})),s.stopEventBubbleUp)return;for(var h=s.getParentList().reverse(),a=0;a<h.length;a++){var c=h[a];if(c.triggerListener(e,new t.Event({x:i,y:r,type:e,target:c,originEvent:n})),o.push(c),c.stopEventBubbleUp)break}}return o}}(o),function(t){t.UI.Polygon=function(e){e=e||{},t.UI.Base.call(this,e),this.yccClass=t.UI.Polygon,this.x=0,this.y=0,this.fill=!0,this.fillStyle="blue",this.noneZeroMode=1,this.isDrawIndex=!1,this.coordinates=e.coordinates||[],this.extend(e)},t.utils.mergeObject(t.UI.Polygon.prototype,t.UI.Base.prototype),t.UI.Polygon.prototype.constructor=t.UI.Polygon,t.UI.Polygon.prototype.computeUIProps=function(){this.coordinates[0]&&(this.x=this.coordinates[0].x,this.y=this.coordinates[0].y)},t.UI.Polygon.prototype.render=function(t){return t=t||this.ctxCache,this.ctx?(t.save(),t.fillStyle=this.fillStyle,t.strokeStyle=this.strokeStyle,this.renderPath(t),this.fill?t.fill():t.stroke(),void t.restore()):void console.error("[Ycc error]:","ctx is null !")},t.UI.Polygon.prototype.renderPath=function(){if(0!==this.coordinates.length){var t=this.ctxCache,e=this.transformByRotate(this.coordinates[0]);t.beginPath(),t.moveTo(e.x*this.dpi,e.y*this.dpi);for(var i=0;i<this.coordinates.length-1;i++){var r=this.transformByRotate(this.coordinates[i]);this.isDrawIndex&&t.fillText(i+"",r.x-10,r.y+10),t.lineTo(r.x*this.dpi,r.y*this.dpi)}t.closePath()}},t.UI.Polygon.prototype.getAbsolutePositionPolygon=function(){var t=this;return this.coordinates.map((function(e){return t.transformByRotate(e)}))},t.UI.Polygon.prototype.getAbsolutePosition=function(e){e=e||new t.Math.Dot(this.x,this.y);var i=this.getParent();if(i){var r=i.getAbsolutePosition();e.x+=r.x,e.y+=r.y}else e.x=this.x+this.belongTo.x,e.y=this.y+this.belongTo.y;return e},t.UI.Polygon.prototype.getAbsolutePositionRect=function(){if(!this.coordinates[0])return console.log(new t.Debugger.Error("need compute prop coordinates").message);for(var e=this.coordinates[0],i=e.x,r=e.y,n=e.x,s=e.y,o=0;o<this.coordinates.length-1;o++){var h=this.coordinates[o];h.x<i&&(i=h.x),h.x>=n&&(n=h.x),h.y<r&&(r=h.y),h.y>=s&&(s=h.y)}var a=this.transformToAbsolute({x:i,y:r});return new t.Math.Rect(a.x,a.y,n-i,s-r)},t.UI.Polygon.prototype.renderDashBeforeUI=function(e){if(this.isShowRotateBeforeUI&&0!==this.coordinates.length){var i=this;e=e||i.ctx;var r=this.getParent(),n=r?r.getAbsolutePosition():new t.Math.Dot,s=new t.Math.Dot(this.coordinates[0].x+n.x,this.coordinates[0].y+n.y);e.save(),e.setLineDash&&e.setLineDash([10]),e.beginPath(),e.moveTo(s.x*this.dpi,s.y*this.dpi);for(var o=0;o<i.coordinates.length-1;o++){var h=i.coordinates[o];e.lineTo(h.x*this.dpi+n.x*this.dpi,h.y*this.dpi+n.y*this.dpi)}e.closePath(),e.strokeStyle=this.strokeStyle,e.stroke(),e.restore()}},t.UI.Polygon.prototype.containDot=function(t,e){e=e||this.noneZeroMode;for(var i=t,r=i.x,n=i.y,s=0,o=0,h=0,a=0;a<this.coordinates.length-1;a++){var c=this.transformByRotate(this.coordinates[a]),l=this.transformByRotate(this.coordinates[a+1]);if(c.x!==l.x){var u=(l.y-c.y)/(l.x-c.x),p=(n-c.y)/u+c.x;r>p||(l.x>c.x&&p>=c.x&&p<=l.x&&(s++,u>=0?o++:h++),l.x<c.x&&p>=l.x&&p<=c.x&&(s++,u>=0?h++:o++))}else{if(r>c.x)continue;l.y>c.y&&n>=c.y&&n<=l.y&&(o++,s++),l.y<c.y&&n>=l.y&&n<=c.y&&(h++,s++)}}return 1===e?o-h!=0:s%2==1}}(o),function(t){t.UI.Ellipse=function(e){t.UI.Polygon.call(this,e),this.yccClass=t.UI.Ellipse,this.point=new t.Math.Dot,this.width=20,this.height=10,this.angle=0,this.color="black",this.fill=!1,this.extend(e)},t.utils.mergeObject(t.UI.Ellipse.prototype,t.UI.Polygon.prototype),t.UI.Ellipse.prototype.constructor=t.UI.Ellipse,t.UI.Ellipse.prototype.computeUIProps=function(){var t=this.point.x,e=this.point.y,i=this.width/2,r=this.height/2,n=this.angle/180*Math.PI,s=Math.sqrt(Math.cos(n)*Math.cos(n)*r*r+Math.sin(n)*Math.sin(n)*i*i)+e,o=2*e-s,h=Math.sqrt(Math.cos(n)*Math.cos(n)*i*i+Math.sin(n)*Math.sin(n)*r*r)+t,a=2*t-h;this.rect.x=a,this.rect.y=o,this.rect.width=h-a,this.rect.height=s-o,this.coordinates=this.rect.getVertices(),this.x=this.point.x,this.y=this.point.y},t.UI.Ellipse.prototype.render=function(){var t=this.width*this.dpi,e=this.angle,i=this.height*this.dpi,r=this.transformByRotate(this.point),n=this.ctxCache;n.save();var s=t>i?t:i,o=r.x*this.dpi,h=r.y*this.dpi,a=t/s,c=i/s;n.translate(o,h),n.rotate(parseInt(e)*Math.PI/180),n.translate(-o,-h),n.scale(a,c),n.beginPath(),n.arc(o/a,h/c,s/2,0,2*Math.PI,!1),n.closePath(),n.fillStyle=this.ctx.strokeStyle=this.color,this.fill?n.fill():n.stroke(),n.restore()},t.UI.Ellipse.prototype.containDot=function(e,i){var r=this.transformByRotate(this.point);return e=new t.Math.Dot(e).rotate(-this.angle,r),Math.pow((e.x-r.x)/this.width*2,2)+Math.pow((e.y-r.y)/this.height*2,2)<=1},t.UI.Ellipse.prototype.renderDashBeforeUI=function(t){if(this.isShowRotateBeforeUI&&0!==this.coordinates.length){var e=this.width,i=(this.angle,this.height),r=this.getParent(),n=r?r.transformToAbsolute(this.point):this.point;this.ctx.save();var s=e>i?e:i,o=e/s,h=i/s;this.ctx.scale(o,h),this.ctx.beginPath(),this.ctx.arc(n.x/o,n.y/h,s/2,0,2*Math.PI,!1),this.ctx.closePath(),this.ctx.strokeStyle=this.color,this.ctx.setLineDash&&this.ctx.setLineDash([10]),this.ctx.stroke(),this.ctx.restore()}}}(o),function(t){t.UI.Circle=function(e){t.UI.Polygon.call(this,e),this.yccClass=t.UI.Circle,this.point=null,this.r=10,this.color="black",this.fill=!0,this.lineWidth=1,this.extend(e)},t.utils.mergeObject(t.UI.Circle.prototype,t.UI.Polygon.prototype),t.UI.Circle.prototype.computeUIProps=function(){if(!this.point)return new t.Debugger.Error("Circle need prop point");var e=this.point.x,i=this.point.y,r=this.r;this.rect=new t.Math.Rect(e-r,i-r,2*r,2*r),this.coordinates=this.rect.getVertices(),this.x=this.point.x,this.y=this.point.y},t.UI.Circle.prototype.render=function(){var t=this.ctxCache,e=this.transformByRotate(this.point);t.save(),t.beginPath(),t.fillStyle=this.color,t.strokeStyle=this.color,t.lineWidth=this.lineWidth,t.arc(e.x*this.dpi,e.y*this.dpi,this.r*this.dpi,0,2*Math.PI),t.closePath(),this.fill?t.fill():t.stroke(),t.restore()},t.UI.Circle.prototype.renderDashBeforeUI=function(t){if(this.isShowRotateBeforeUI&&0!==this.coordinates.length){t=this.ctx;var e=this.getParent(),i=e?e.transformToAbsolute(this.point):this.point;t.save(),t.setLineDash&&t.setLineDash([10]),t.beginPath(),this.ctx.arc(i.x,i.y,this.r,0,2*Math.PI),t.closePath(),t.strokeStyle=this.color,t.stroke(),t.restore()}},t.UI.Circle.prototype.containDot=function(t,e){var i=this.transformByRotate(this.point);return Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2)<=Math.pow(this.r,2)}}(o),function(t){t.UI.Image=function(e){t.UI.Polygon.call(this,e),this.yccClass=t.UI.Image,this.fillMode="none",this.res=null,this.mirror=0,this.scale9GridRect=null,this.scaleRepeatRect=null,this.extend(e)},t.utils.mergeObject(t.UI.Image.prototype,t.UI.Polygon.prototype),t.UI.Image.prototype.constructor=t.UI.Image,t.UI.Image.prototype.computeUIProps=function(){"auto"===this.fillMode&&(this.rect.width=this.res.width,this.rect.height=this.res.height),this.coordinates=this.rect.getVertices(),this.x=this.rect.x,this.y=this.rect.y},t.UI.Image.prototype._processMirror=function(t){var e=this.ctxCache,i=t.x*this.dpi,r=t.y*this.dpi,n=t.width*this.dpi,s=t.height*this.dpi;1===this.mirror&&(e.scale(-1,1),e.translate(2*-i-n,0)),2===this.mirror&&(e.scale(1,-1),e.translate(0,2*-r-s)),3===this.mirror&&(e.scale(-1,-1),e.translate(2*-i-n,2*-r-s))},t.UI.Image.prototype.render=function(){var e=this.ctxCache;e.save();var i,r,n,s,o,h,a=this.getAbsolutePositionRect(),c=this.res,l=a.x*this.dpi,u=a.y*this.dpi,p=a.width*this.dpi,d=a.height*this.dpi,g=c.width*this.dpi,y=c.height*this.dpi,f=this.transformToAbsolute({x:this.anchorX,y:this.anchorY});if(e.translate(f.x*this.dpi,f.y*this.dpi),e.rotate(this.rotation*Math.PI/180),e.translate(-f.x*this.dpi,-f.y*this.dpi),this._processMirror(a),"none"===this.fillMode)e.drawImage(this.res,0,0,a.width,a.height,a.x,a.y,a.width,a.height);else if("scale"===this.fillMode)e.drawImage(this.res,0,0,c.width,c.height,l,u,p,d);else if("auto"===this.fillMode)e.drawImage(this.res,0,0,c.width,c.height,l,u,p,d);else if("repeat"===this.fillMode)for(n=parseInt(p/g)+1,s=parseInt(d/y)+1,i=0;i<n;i++)for(r=0;r<s;r++)o=c.width,h=c.height,i===n-1&&(o=a.width-i*c.width),r===s-1&&(h=a.height-r*c.height),e.drawImage(this.res,0,0,o,h,l+g*i,u+y*r,o*this.dpi,h*this.dpi);else if("scaleRepeat"===this.fillMode)for(n=parseInt(a.width/this.scaleRepeatRect.width)+1,s=parseInt(a.height/this.scaleRepeatRect.height)+1,i=0;i<n;i++)for(r=0;r<s;r++)o=this.scaleRepeatRect.width,h=this.scaleRepeatRect.height,i===n-1&&(o=a.width-i*this.scaleRepeatRect.width),r===s-1&&(h=a.height-r*this.scaleRepeatRect.height),this.ctx.drawImage(this.res,0,0,c.width,c.height,a.x*this.dpi+this.scaleRepeatRect.width*i,a.y*this.dpi+this.scaleRepeatRect.height*r,o*this.dpi,h*this.dpi);else if("scale9Grid"===this.fillMode){var x,v,m=this.scale9GridRect,w=[];w[0]={},w[0].src=new t.Math.Rect(0,0,m.x,m.y),w[0].dest=new t.Math.Rect(a.x,a.y,m.x,m.y),w[2]={},w[2].src=new t.Math.Rect(m.x+m.width,0,c.width-m.x-m.width,m.y),w[2].dest=new t.Math.Rect(a.width-w[2].src.width+a.x,a.y,w[2].src.width,w[2].src.height),w[6]={},w[6].src=new t.Math.Rect(0,m.y+m.height,m.x,c.height-m.y-m.height),w[6].dest=new t.Math.Rect(a.x,a.y+a.height-w[6].src.height,w[6].src.width,w[6].src.height),w[8]={},w[8].src=new t.Math.Rect(m.x+m.width,m.y+m.height,c.width-m.x-m.width,c.height-m.y-m.height),w[8].dest=new t.Math.Rect(a.width-w[8].src.width+a.x,a.y+a.height-w[8].src.height,w[8].src.width,w[8].src.height),w[1]={},w[1].src=new t.Math.Rect(m.x,0,m.width,m.y),w[1].dest=new t.Math.Rect(w[0].dest.x+w[0].dest.width,a.y,a.width-w[0].dest.width-w[2].dest.width,m.y),w[3]={},w[3].src=new t.Math.Rect(w[0].src.x,m.y,w[0].src.width,m.height),w[3].dest=new t.Math.Rect(w[0].dest.x,w[0].dest.y+w[0].dest.height,w[0].dest.width,a.height-w[0].dest.height-w[6].dest.height),w[5]={},w[5].src=new t.Math.Rect(w[2].src.x,m.y,w[2].src.width,m.height),w[5].dest=new t.Math.Rect(w[2].dest.x,w[3].dest.y,w[2].dest.width,w[3].dest.height),w[7]={},w[7].src=new t.Math.Rect(w[1].src.x,w[6].src.y,m.width,w[6].src.height),w[7].dest=new t.Math.Rect(w[1].dest.x,w[6].dest.y,w[1].dest.width,w[6].dest.height),w[4]={},w[4].src=new t.Math.Rect(m.x,m.y,m.width,m.height),w[4].dest=new t.Math.Rect(w[1].dest.x,w[5].dest.y,w[1].dest.width,w[5].dest.height);for(var I=0;I<w.length;I++)w[I]&&(x=w[I].src,v=w[I].dest,e.drawImage(this.res,x.x,x.y,x.width,x.height,v.x*this.dpi,v.y*this.dpi,v.width*this.dpi,v.height*this.dpi))}e.restore()}}(o),function(t){t.UI.ImageFrameAnimation=function(e){t.UI.Polygon.call(this,e),this.yccClass=t.UI.ImageFrameAnimation,this.res=null,this.frameSpace=1,this.firstFrameRect=null,this.startFrameCount=0,this.frameRectCount=1,this.autoplay=!1,this.isRunning=!1,this.mirror=0,this.extend(e),this.isRunning=this.autoplay},t.utils.mergeObject(t.UI.ImageFrameAnimation.prototype,t.UI.Polygon.prototype),t.UI.ImageFrameAnimation.prototype.constructor=t.UI.ImageFrameAnimation,t.UI.ImageFrameAnimation.prototype.computeUIProps=function(){this.coordinates=this.rect.getVertices(),this.x=this.rect.x,this.y=this.rect.y},t.UI.ImageFrameAnimation.prototype._processMirror=function(t){var e=this.ctxCache,i=t.x*this.dpi,r=t.y*this.dpi,n=t.width*this.dpi,s=t.height*this.dpi;1===this.mirror&&(e.scale(-1,1),e.translate(2*-i-n,0)),2===this.mirror&&(e.scale(1,-1),e.translate(0,2*-r-s)),3===this.mirror&&(e.scale(-1,-1),e.translate(2*-i-n,2*-r-s))},t.UI.ImageFrameAnimation.prototype.render=function(){var t=this.ctxCache,e=this.getAbsolutePositionRect(),i=e.x*this.dpi,r=e.y*this.dpi,n=e.width*this.dpi,s=e.height*this.dpi,o=parseInt((this.belongTo.yccInstance.ticker.frameAllCount-this.startFrameCount)/this.frameSpace)%this.frameRectCount+1;(!this.isRunning||o>=this.frameRectCount)&&(o=0),t.save(),this.scaleAndRotate(),this._processMirror(e),t.drawImage(this.res,this.firstFrameRect.x+this.firstFrameRect.width*o,this.firstFrameRect.y,this.firstFrameRect.width,this.firstFrameRect.height,i,r,n,s),t.restore()},t.UI.ImageFrameAnimation.prototype.start=function(){this.startFrameCount=this.belongTo.yccInstance.ticker.frameAllCount,this.isRunning=!0},t.UI.ImageFrameAnimation.prototype.stop=function(){this.isRunning=!1}}(o),function(t){t.UI.Line=function(e){t.UI.Polygon.call(this,e),this.yccClass=t.UI.Line,this.start=new t.Math.Dot(0,0),this.end=new t.Math.Dot(0,0),this.width=1,this.color="black",this.extend(e)},t.utils.mergeObject(t.UI.Line.prototype,t.UI.Polygon.prototype),t.UI.Line.prototype.constructor=t.UI.Line,t.UI.Line.prototype.computeUIProps=function(){this.rect.x=this.start.x<this.end.x?this.start.x:this.end.x,this.rect.y=this.start.y<this.end.y?this.start.y:this.end.y,this.rect.width=Math.abs(this.start.x-this.end.x),this.rect.height=Math.abs(this.start.y-this.end.y);var t=this.start.x,e=this.start.y,i=this.end.x,r=this.end.y,n=-(i-t)/(r-e);if(r-e==0)this.coordinates=[{x:this.start.x,y:this.start.y-this.width/2},{x:this.start.x,y:this.start.y+this.width/2},{x:this.end.x,y:this.end.y+this.width/2},{x:this.end.x,y:this.end.y-this.width/2},{x:this.start.x,y:this.start.y-this.width/2}];else{var s=t-Math.pow(Math.pow(this.width/2,2)/(n*n+1),.5),o=t+Math.pow(Math.pow(this.width/2,2)/(n*n+1),.5),h=i+Math.pow(Math.pow(this.width/2,2)/(n*n+1),.5),a=i-Math.pow(Math.pow(this.width/2,2)/(n*n+1),.5),c=n*(s-t)+e,l=n*(o-t)+e,u=n*(h-i)+r,p=n*(a-i)+r;this.coordinates=[{x:s,y:c},{x:o,y:l},{x:h,y:u},{x:a,y:p},{x:s,y:c}]}this.x=this.start.x,this.y=this.start.y,this.strokeStyle=this.color,this.fillStyle=this.color}}(o),function(t){t.UI.BrokenLine=function(e){t.UI.Polygon.call(this,e),this.yccClass=t.UI.BrokenLine,this.pointList=[],this.width=1,this.color="black",this.smooth=!1,this.extend(e)},t.utils.mergeObject(t.UI.BrokenLine.prototype,t.UI.Polygon.prototype),t.UI.BrokenLine.prototype.computeUIProps=function(){if(0===this.pointList.length)return this.rect.x=0,this.rect.y=0,this.rect.width=0,this.rect.height=0,null;for(var t=this.pointList[0].x,e=this.pointList[0].y,i=this.pointList[0].x,r=this.pointList[0].y,n=0;n<this.pointList.length;n++){var s=this.pointList[n];s.x<t?t=s.x:s.x>i&&(i=s.x),s.y<e?e=s.y:s.y>r&&(r=s.y)}this.rect.x=t,this.rect.y=e,this.rect.width=i-t,this.rect.height=r-e,this.coordinates=this.rect.getVertices(),this.x=this.rect.x,this.y=this.rect.y},t.UI.BrokenLine.prototype.render=function(){if(this.pointList.length<2)return null;var t=this.ctxCache;this.getParent(),t.save(),t.strokeStyle=this.color,t.strokeWidth=this.width,t.beginPath();var e=this.transformByRotate(this.pointList);this.smooth?this._smoothLineRender(e):this._normalRender(e),t.closePath(),t.restore()},t.UI.BrokenLine.prototype._normalRender=function(t){var e=this.ctxCache;e.moveTo(t[0].x*this.dpi,t[0].y*this.dpi);for(var i=1;i<t.length;i++)e.lineTo(t[i].x*this.dpi,t[i].y*this.dpi);e.stroke()},t.UI.BrokenLine.prototype._smoothLineRender=function(e){var i=this.ctxCache,r=function(e){var i=[];i.push({start:e[0],end:e[1],dot1:e[0],dot2:null});for(var r=1;r<e.length-1;r++){var n=e[r],s=e[r+1],o=e[r-1],h=new t.Math.Dot(n.x-1/3*Math.abs(n.x-o.x),n.y),a=new t.Math.Dot(n.x+1/3*Math.abs(n.x-s.x),n.y);i[r-1].dot2=h,i.push({start:n,end:s,dot1:a,dot2:null})}return i[i.length-1].dot2=e[e.length-1],i}(e);i.beginPath();for(var n=0;n<r.length;n++)i.moveTo(r[n].start.x*this.dpi,r[n].start.y*this.dpi),i.bezierCurveTo(r[n].dot1.x*this.dpi,r[n].dot1.y*this.dpi,r[n].dot2.x*this.dpi,r[n].dot2.y*this.dpi,r[n].end.x*this.dpi,r[n].end.y*this.dpi);i.stroke()},t.UI.BrokenLine.prototype._smoothLineRender02=function(t){}}(o),function(t){t.UI.MultiLineText=function(e){t.UI.Polygon.call(this,e),this.yccClass=t.UI.MultiLineText,this.displayLines=[],this.content="",this.fontSize="16px",this.lineHeight=24,this.fill=!0,this.color="black",this.wordBreak="break-all",this.overflow="auto",this.extend(e)},t.utils.mergeObject(t.UI.MultiLineText.prototype,t.UI.Polygon.prototype),t.UI.MultiLineText.prototype.constructor=t.UI.MultiLineText,t.UI.MultiLineText.prototype.computeUIProps=function(){var t=this,e=this.ctxCache;t.belongTo._setCtxProps(t,e);var i=this,r=this.content.split(/(?:\r\n|\r|\n)/);this.displayLines=function(){function n(){function n(r){var s=[];if(e.measureText(r).width<=i.rect.width*t.dpi)return s.push(r),s;for(var o=0;o<r.length;o++){var h=r.slice(0,o+1);if(e.measureText(h).width>i.rect.width*t.dpi){var a=r.slice(0,o-1);s.push(a);var c=r.slice(o-1);return s.concat(n(c))}}}for(var s=[],o=0;o<r.length;o++){var h=n(r[o]);s=s.concat(h)}return s}switch(i.wordBreak){case"no-break":case"break-all":return n();case"break-word":return function(){function n(r){var s=[];if(e.measureText(r).width<=i.rect.width*t.dpi)return s.push(r),s;for(var o=0,h=0;h<r.length;h++){var a=r.slice(0,h+1),c=e.measureText(a).width,l=r[h];if(" "===l&&(o=h),c>i.rect.width*t.dpi){var u="",p="";return" "===l||0===o?(u=r.slice(0,h),s.push(u),p=r.slice(h),s=s.concat(n(p))):(u=r.slice(0,o),s.push(u),p=r.slice(o),s=s.concat(n(p)))}}}for(var s=[],o=0;o<r.length;o++){var h=n(r[o]);s=s.concat(h)}return s}();default:return n()}}(),"auto"===i.overflow&&(i.rect.height=i.lineHeight*this.displayLines.length),this.coordinates=this.rect.getVertices(),this.x=this.rect.x,this.y=this.rect.y},t.UI.MultiLineText.prototype.render=function(t){var e=this;if(t=t||this.ctxCache){var i=this,r=this.getAbsolutePositionRect(),n=i.lineHeight*e.dpi;t.save(),t.fillStyle=i.color,t.strokeStyle=i.color;var s=this.transformToAbsolute({x:this.anchorX,y:this.anchorY});t.translate(s.x,s.y),t.rotate(this.rotation*Math.PI/180),t.translate(-s.x,-s.y);for(var o=0;o<e.displayLines.length;o++){var h=r.x*e.dpi,a=r.y*e.dpi+o*i.lineHeight*e.dpi;if(a+n>r.y*e.dpi+r.height*e.dpi)break;t.fillText(e.displayLines[o],h,a)}t.restore()}else console.error("[Ycc error]:","ctx is null !")}}(o),function(t){t.UI.Rect=function(e){t.UI.Polygon.call(this,e),this.yccClass=t.UI.Rect,this.fill=!0,this.color="black",this.extend(e)},t.utils.mergeObject(t.UI.Rect.prototype,t.UI.Polygon.prototype),t.UI.Rect.prototype.computeUIProps=function(){this.coordinates=this.rect.getVertices(),this.x=this.rect.x,this.y=this.rect.y},t.UI.Rect.prototype.render=function(t){return(t=t||this.ctxCache)?(t.save(),t.fillStyle=this.color,t.strokeStyle=this.color,this.renderPath(t),this.fill?t.fill():t.stroke(),void t.restore()):void console.error("[Ycc error]:","ctx is null !")}}(o),function(t){t.UI.CropRect=function(e){t.UI.Polygon.call(this,e),this.yccClass=t.UI.CropRect,this.ctrlSize=6,this.enableDragOut=!1,this.fill=!0,this.ctrlRect1=new t.Math.Rect,this.ctrlRect2=new t.Math.Rect,this.ctrlRect3=new t.Math.Rect,this.ctrlRect4=new t.Math.Rect,this.btns=[],this.btnHeight=38,this.btnVerticalPadding=10,this.showName=!0,this.extend(e),this._initUI()},t.utils.mergeObject(t.UI.CropRect.prototype,t.UI.Polygon.prototype),t.UI.CropRect.prototype.showBtns=function(e){if(this.btns.length>0){for(var i=0;i<this.btns.length;i++)t.utils.isObj(this.btns[i])&&(this.btns[i].show=e);this.belongTo.yccInstance.layerManager.reRenderAllLayerToStage()}},t.UI.CropRect.prototype.setCtrlBtns=function(e){var i=this;0!==e.length&&e.forEach((function(e){e=t.utils.extend({content:"",rectBgColor:"#666",color:"#fff",ontap:function(){}},e);var r=new t.UI.SingleLineText(e);r.addListener("mouseover",(function(){this.color="#ccc",this.belongTo.yccInstance.layerManager.reRenderAllLayerToStage()})),r.addListener("mouseout",(function(){this.color="#fff",this.belongTo.yccInstance.layerManager.reRenderAllLayerToStage()})),i.btns.push(r),i.belongTo.addUI(r)}))},t.UI.CropRect.prototype.computeUIProps=function(){this.belongTo._setCtxProps(this);var e=this.rect,i=0,r=0,n=this.rect.x,s=this.rect.y+this.rect.height,o=this.belongTo.yccInstance.getStageWidth(),h=this.belongTo.yccInstance.getStageHeight();if(this.ctrlRect1=new t.Math.Rect(e.x,e.y,this.ctrlSize,this.ctrlSize),this.ctrlRect2=new t.Math.Rect(e.x+e.width-this.ctrlSize,e.y,this.ctrlSize,this.ctrlSize),this.ctrlRect3=new t.Math.Rect(e.x,e.y+e.height-this.ctrlSize,this.ctrlSize,this.ctrlSize),this.ctrlRect4=new t.Math.Rect(e.x+e.width-this.ctrlSize,e.y+e.height-this.ctrlSize,this.ctrlSize,this.ctrlSize),0!==this.btns.length){for(var a=0;a<this.btns.length;a++){var c=this.btns[a];c.overflow="auto",c.xAlign="center",c.rect.width=parseInt(this.ctx.measureText(c.content).width+2*this.btnVerticalPadding),c.rect.height=this.btnHeight,i+=c.rect.width+1}n+i>o&&(n=o-i),s+this.btnHeight>h&&(s=this.rect.y<this.btnHeight?0:this.rect.y-this.btnHeight-2);for(var l=0;l<this.btns.length;l++){var u=this.btns[l];u.rect.x=n+r,u.rect.y=s+2,r+=u.rect.width+1}this.coordinates=this.rect.getVertices(),this.x=this.rect.x,this.y=this.rect.y}},t.UI.CropRect.prototype._initUI=function(){var e=this,i=null,r=null;this.userData=this.userData?this.userData:{},this.addListener("dragstart",(function(n){console.log("dragstart",n),this.userData.ctrlStart=0,this.userData.dragStartPosition=new t.Math.Rect(this.rect),this.userData.dragStartMousePosition=new t.Math.Dot(n);var s=new t.Math.Dot(n);i=s,r=new t.Math.Rect(e.rect);for(var o=1;o<=4;o++)if(s.isInRect(this["ctrlRect"+o]))return this.userData.ctrlStart=o,null})),this.addListener("dragging",(function(t){var e,n,s,o,h=this.userData.dragStartPosition,a=this.userData.dragStartMousePosition;if(this.userData.ctrlStart<=4&&this.userData.ctrlStart>=1?(1===this.userData.ctrlStart&&(e=t.x-(a.x-h.x),n=t.y-(a.y-h.y),s=h.width-(t.x-h.x),o=h.height-(t.y-h.y),e<=h.x+h.width-2*this.ctrlSize&&(this.rect.x=e),n<=h.y+h.height-2*this.ctrlSize&&(this.rect.y=n)),2===this.userData.ctrlStart&&(e=h.x,n=t.y-(a.y-h.y),s=t.x-h.x+(h.width+h.x-a.x),o=h.height-(t.y-h.y),this.rect.x=e,n<=h.y+h.height-2*this.ctrlSize&&(this.rect.y=n)),3===this.userData.ctrlStart&&(e=t.x-(a.x-h.x),n=h.y,s=h.width-(t.x-h.x),o=t.y-h.y+(h.height+h.y-a.y),e<=h.x+h.width-2*this.ctrlSize&&(this.rect.x=e),this.rect.y=n),4===this.userData.ctrlStart&&(this.rect.x=h.x,this.rect.y=h.y,this.rect.width=t.x-h.x+(h.x+h.width-a.x),this.rect.height=t.y-h.y+(h.y+h.height-a.y)),s>=2*this.ctrlSize&&(this.rect.width=s),o>=2*this.ctrlSize&&(this.rect.height=o)):(this.rect.x=r.x+t.x-i.x,this.rect.y=r.y+t.y-i.y),this.rect.width<=2*this.ctrlSize&&(this.rect.width=2*this.ctrlSize),this.rect.height<=2*this.ctrlSize&&(this.rect.height=2*this.ctrlSize),!this.enableDragOut){var c=this.belongTo.yccInstance.getStageWidth(),l=this.belongTo.yccInstance.getStageHeight();this.rect.x<=0&&(this.rect.x=0),this.rect.y<=0&&(this.rect.y=0),this.rect.x+this.rect.width>=c&&(this.rect.x=c-this.rect.width),this.rect.y+this.rect.height>=l&&(this.rect.y=l-this.rect.height)}this.belongTo.yccInstance.layerManager.reRenderAllLayerToStage()})),this.addListener("dragend",(function(t){e.showBtns(!0)}))},t.UI.CropRect.prototype.render=function(){var t=this.rect;this.ctx.save(),this.ctx.fillStyle=this.fillStyle,this.ctx.strokeStyle=this.strokeStyle,this.ctx.beginPath(),this.ctx.rect(t.x,t.y,t.width,t.height),this.ctx.closePath(),this.fill?this.ctx.fill():this.ctx.stroke(),this.ctx.beginPath(),this.ctx.rect(this.ctrlRect1.x,this.ctrlRect1.y,this.ctrlRect1.width,this.ctrlRect1.height),this.ctx.rect(this.ctrlRect2.x,this.ctrlRect2.y,this.ctrlRect2.width,this.ctrlRect2.height),this.ctx.rect(this.ctrlRect3.x,this.ctrlRect3.y,this.ctrlRect3.width,this.ctrlRect3.height),this.ctx.rect(this.ctrlRect4.x,this.ctrlRect4.y,this.ctrlRect4.width,this.ctrlRect4.height),this.ctx.closePath(),this.ctx.fill(),this.ctx.restore(),this.ctx.save(),this.ctx.beginPath(),this.ctx.fillStyle="blue",this.ctx.font="normal normal bold 14px Arial",this.ctx.fillText(this.name,t.x+10,t.y+10),this.ctx.closePath(),this.ctx.restore()},t.UI.CropRect.prototype.removeSelf=function(){this.belongTo.removeUI(this),this.btns.forEach((function(t){t.removeSelf()}))}}(o),function(t){t.UI.SingleLineText=function(e){t.UI.Polygon.call(this,e),this.yccClass=t.UI.SingleLineText,this.displayContent="",this.content="",this.fontSize="16px",this.fill=!0,this.color="black",this.xAlign="left",this.yAlign="center",this.overflow="auto",this.extend(e)},t.utils.mergeObject(t.UI.SingleLineText.prototype,t.UI.Polygon.prototype),t.UI.SingleLineText.prototype.constructor=t.UI.SingleLineText,t.UI.SingleLineText.prototype.computeUIProps=function(){var t=this,e=this.ctxCache,i=this.rect,r=(i.x,this.dpi,i.y,this.dpi,i.width*this.dpi);i.height,this.dpi,this._setCtxProps(t);var n=e.measureText(this.content).width;this.displayContent=this.content,"hidden"===this.overflow?n>r&&(t.displayContent=t.getMaxContentInWidth(this.content,r)):"auto"===this.overflow&&(n>r&&(this.rect.width=n/this.dpi),parseInt(this.fontSize)>this.rect.height&&(this.rect.height=parseInt(this.fontSize))),this.coordinates=this.rect.getVertices(),this.x=this.rect.x,this.y=this.rect.y},t.UI.SingleLineText.prototype.render=function(e){var i=this;if(e=e||i.ctxCache){i.belongTo._setCtxProps(i,e);var r,n,s=this.belongTo.yccInstance.getSystemInfo().devicePixelRatio,o=parseInt(i.fontSize)*s,h=this,a=this.getAbsolutePositionRect();r=(a=new t.Math.Rect(a.x*s,a.y*s,a.width*s,a.height*s)).x;var c=e.measureText(this.displayContent).width;if("center"===this.xAlign&&(r+=(a.width-c)/2),"right"===this.xAlign&&(r+=a.width-c),n=a.y,o>a.height)return console.warn("[Ycc warning] : ","行高不够，或者文字太大！",h);"center"===h.yAlign&&(n=n+a.height/2-o/2),e.save();var l=this.transformToAbsolute({x:this.anchorX,y:this.anchorY});e.translate(l.x*this.dpi,l.y*this.dpi),e.rotate(this.rotation*Math.PI/180),e.translate(-l.x*this.dpi,-l.y*this.dpi),e.fillStyle=h.color,e.strokeStyle=h.color,e.fillText(i.displayContent,r,n),e.restore()}else console.error("[Ycc error]:","ctx is null !")}}(o),function(t){t.UI.ScrollerRect=function(e){t.UI.Polygon.call(this,e),this.yccClass=t.UI.ScrollerRect,this.selfRender=!1,this.contentW=0,this.contentH=0,this.enableSwipe=!1,this.swipeFrameCount=10,this.swipeAcceleration=.5,this.swipeInitSpeed=20,this.extend(e),this.ghost=!0,this._wrapper=null,this._eventWrapper=null,this.stopEventBubbleUp=!1,this._onAdded=function(){this._initWrapperRect(),this._initEvent()},this._onChildrenRendered=function(){this.ctx.restore()}},t.utils.mergeObject(t.UI.ScrollerRect.prototype,t.UI.Polygon.prototype),t.UI.ScrollerRect.prototype.computeUIProps=function(){this.coordinates=this.rect.getVertices(),this.x=this.rect.x,this.y=this.rect.y},t.UI.ScrollerRect.prototype.render=function(t){(t=t||this.ctxCache).save(),this.renderPath(t),t.clip()},t.UI.ScrollerRect.prototype.addChild=function(t){return this.belongTo&&t.init(this.belongTo),t===this._wrapper||t===this._eventWrapper?this.addChildTree(t):this._wrapper.addChildTree(t),t},t.UI.ScrollerRect.prototype._initEvent=function(){function e(){i.selfRender&&i.belongTo&&i.belongTo.yccInstance&&i.belongTo.yccInstance.layerManager.reRenderAllLayerToStage()}var i=this;if(!i.belongTo)return console.log("scroller need add to stage!");var r=i.belongTo.yccInstance.ticker,n={rect:null,startEvent:null,tickerIsRunning:!1},s={rect:null,endEvent:null},o=!1;this._eventWrapper.addListener("tap",(function(t){var e=i.belongTo.getUIListFromPointer(t,{uiIsShow:!0,uiIsGhost:!1});(e=e.filter((function(t){return t.show&&!t.ghost}))).length<=1||e[e.length-2].triggerUIEventBubbleUp("tap",t.x,t.y)})),this._eventWrapper.addListener("dragstart",(function(s){n.tickerIsRunning=r._isRunning,n.startEvent=s,n.rect=new t.Math.Rect(i._wrapper.rect),o=!0,r.start(),r.addFrameListener(e)})),this._eventWrapper.addListener("dragging",(function(t){var e=t.x-n.startEvent.x,r=t.y-n.startEvent.y;o=!0,i._wrapper.rect.x=n.rect.x+e,i._wrapper.rect.y=n.rect.y+r,i._checkRangeLimit()})),this._eventWrapper.addListener("dragend",(function(n){s.endEvent=n,s.rect=new t.Math.Rect(i._wrapper.rect),r.removeFrameListener(e)})),this._eventWrapper.addListener("swipe",(function(t){if(!i.enableSwipe){var e=t.originEvent.swipeDirection,n={left:-1,right:1,up:-1,down:1},h=i.swipeInitSpeed,a=i.swipeFrameCount,c=0,l=0;o=!1,r.addFrameListener((function t(){return l++,c=l*(h-i.swipeAcceleration*l),l>=a||c<=0||o?void r.removeFrameListener(t):("left"!==e&&"right"!==e||(i._wrapper.rect.x=s.rect.x+n[e]*c),"up"!==e&&"down"!==e||(i._wrapper.rect.y=s.rect.y+n[e]*c),i._checkRangeLimit(),void(i.selfRender&&i.belongTo&&i.belongTo.yccInstance&&i.belongTo.yccInstance.layerManager.reRenderAllLayerToStage()))}))}}))},t.UI.ScrollerRect.prototype._initWrapperRect=function(){this._wrapper=new t.UI.Rect({name:"滚动区UI容器",opacity:0,rect:new t.Math.Rect(0,0,this.rect.width,this.rect.height),ghost:!0}),this._eventWrapper=new t.UI.Rect({name:"滚动区事件容器",opacity:0,rect:new t.Math.Rect(this.rect.x,this.rect.y,this.rect.width,this.rect.height),ghost:!1}),this.addChild(this._wrapper),this.belongTo.addUI(this._eventWrapper)},t.UI.ScrollerRect.prototype._checkRangeLimit=function(){var t=this,e=t.contentW-t.rect.width,i=t.contentH-t.rect.height;t._wrapper.rect.x=t._wrapper.rect.x>=0?0:t._wrapper.rect.x,t._wrapper.rect.y=t._wrapper.rect.y>=0?0:t._wrapper.rect.y,t._wrapper.rect.x=t._wrapper.rect.x<-e?-e:t._wrapper.rect.x,t._wrapper.rect.y=t._wrapper.rect.y<-i?-i:t._wrapper.rect.y,t.contentW<=t.rect.width&&(t._wrapper.rect.x=0),t.contentH<=t.rect.height&&(t._wrapper.rect.y=0)}}(o),function(t){t.UI.ComponentButton=function(e){t.UI.Base.call(this,e),this.yccClass=t.UI.ComponentButton,this.rectBorderWidth=1,this.rectBorderColor="#000",this.backgroundImageRes=null,this.text="",this.textColor="black",this.__bgUI=null,this.__textUI=null,this.extend(e),this.__componentInit()},t.utils.mergeObject(t.UI.ComponentButton.prototype,t.UI.Base.prototype),t.UI.ComponentButton.prototype.constructor=t.UI.ComponentButton,t.UI.ComponentButton.prototype.__componentInit=function(){this.backgroundImageRes&&(this.__bgUI=new t.UI.Image({rect:new t.Math.Rect(0,0,this.rect.width,this.rect.height),fillMode:"scale",res:this.backgroundImageRes,stopEventBubbleUp:!1}),this.addChild(this.__bgUI)),""!==this.text&&(this.__textUI=new t.UI.SingleLineText({rect:new t.Math.Rect(0,0,this.rect.width,this.rect.height),content:this.text,color:this.textColor,xAlign:"center",stopEventBubbleUp:!1}),this.addChild(this.__textUI))},t.UI.Base.prototype.computeUIProps=function(){this.__bgUI&&(this.__bgUI.rect.width=this.rect.width,this.__bgUI.rect.height=this.rect.height,this.__bgUI.res=this.backgroundImageRes),this.__textUI&&(this.__textUI.rect.width=this.rect.width,this.__textUI.rect.height=this.rect.height,this.__textUI.content=this.text,this.__textUI.color=this.textColor)}}(o),"undefined"!=typeof wx&&(o.utils.isMobile=function(){return console.log("wx isMobile"),!0},"undefined"!=typeof performance&&(performance.now=function(){return Date.now()}),o.prototype.getSystemInfo=function(){var t=wx.getSystemInfoSync();return{model:t.model,pixelRatio:t.pixelRatio,windowWidth:t.windowWidth,windowHeight:t.windowHeight,screenWidth:t.screenWidth,screenHeight:t.screenHeight,devicePixelRatio:t.devicePixelRatio||1}}),void 0!==t)?t.exports=o:void 0===(n="function"==typeof(r=o)?r.call(e,i,e,t):r)||(t.exports=n)},function(t,e,i){"use strict";i.r(e),function(t){var r=i(0),n=i.n(r);function s(t,e){e=n.a.utils.extend({appenv:"h5",canvasDom:null,wrapW:800,wrapH:600,cropW:200,cropH:200,maskColor:"rgba(0,0,0,0.6)",lineColor:"#fff",callback:function(){}},e),this.options=e,this.imageUrl=t,this.ycc=new n.a({appenv:e.appenv}),this.ycc.bindCanvas(this.ycc.createCanvas({canvasDom:e.canvasDom,width:e.wrapW,height:e.wrapH,dpiAdaptation:!0})),this.layer=this.ycc.layerManager.newLayer({enableEventManager:!0}),this.imageUI=null,this.init()}s.prototype.init=function(){var t=this;this.ycc.loader.loadResOneByOne([{url:this.imageUrl}],(function(e){console.log("loaded!",this),t._onImageLoad(e[0])}),(function(t,e,i){console.log("progress",i,t)})),this.ycc.ticker.addFrameListener((function(){t.ycc.layerManager.reRenderAllLayerToStage()})),this.ycc.ticker.start(60)},s.prototype._onImageLoad=function(t){this._addImage(t),this._addCrop()},s.prototype._addCrop=function(){var t=this.layer;t.addUI(new n.a.UI.Rect({rect:new n.a.Math.Rect(0,0,this.options.wrapW,this.options.wrapH/2-this.options.cropH/2),color:this.options.maskColor,ghost:!0})),t.addUI(new n.a.UI.Rect({rect:new n.a.Math.Rect(0,this.options.wrapH-(this.options.wrapH/2-this.options.cropH/2),this.options.wrapW,this.options.wrapH/2-this.options.cropH/2),color:this.options.maskColor,ghost:!0})),t.addUI(new n.a.UI.Rect({rect:new n.a.Math.Rect(0,this.options.wrapH/2-this.options.cropH/2,this.options.wrapW/2-this.options.cropW/2,this.options.cropH),color:this.options.maskColor,ghost:!0})),t.addUI(new n.a.UI.Rect({rect:new n.a.Math.Rect(this.options.wrapW-(this.options.wrapW/2-this.options.cropW/2),this.options.wrapH/2-this.options.cropH/2,this.options.wrapW/2-this.options.cropW/2,this.options.cropH),color:this.options.maskColor,ghost:!0})),t.addUI(new n.a.UI.Rect({rect:new n.a.Math.Rect(0,this.options.wrapH/2-this.options.cropH/2,this.options.wrapW,1),color:this.options.lineColor,ghost:!0})),t.addUI(new n.a.UI.Rect({rect:new n.a.Math.Rect(this.options.wrapW/2-this.options.cropW/2,0,1,this.options.wrapH),color:this.options.lineColor,ghost:!0})),t.addUI(new n.a.UI.Rect({rect:new n.a.Math.Rect(this.options.wrapW/2+this.options.cropW/2,0,1,this.options.wrapH),color:this.options.lineColor,ghost:!0})),t.addUI(new n.a.UI.Rect({rect:new n.a.Math.Rect(0,this.options.wrapH/2+this.options.cropH/2,this.options.wrapW,1),color:this.options.lineColor,ghost:!0})),t.addUI(new n.a.UI.Rect({rect:new n.a.Math.Rect(this.options.wrapW/2-this.options.cropW/2,this.options.wrapH/2-this.options.cropH/2,this.options.cropW,this.options.cropH),rectBorderWidth:1,rectBorderColor:this.options.lineColor,color:"transparent",ghost:!0}))},s.prototype._addImage=function(t){this.ycc;var e=this,i=t.res.width/this.options.wrapW,r=t.res.height/this.options.wrapH,s=1,o=null;i<r?(s=r,o=new n.a.Math.Rect((this.options.wrapW-t.res.width/s)/2,0,t.res.width/s,t.res.height/s)):(s=i,o=new n.a.Math.Rect(0,(this.options.wrapH-t.res.height/s)/2,t.res.width/s,t.res.height/s)),console.log("scaleRatio",s,i<r),this.imageUI=new n.a.UI.Image({rect:o,fillMode:"scale",res:t.res}),this.layer.addUI(this.imageUI);var h=null;this.ycc.gesture.ondragstart=function(t){console.log(t,1111),this.userData={startPos:new n.a.Math.Dot(t),startRect:new n.a.Math.Rect(e.imageUI.rect)}},this.ycc.gesture.ondragging=function(t){if(this.ismutiltouching)return;if(!this.userData)return;var i=this.userData.startPos,r=this.userData.startRect;let n=t.x-i.x,s=t.y-i.y;e.imageUI.rect.x=r.x+n,e.imageUI.rect.y=r.y+s},this.ycc.gesture.onmultistart=function(t){h=new n.a.Math.Rect(e.imageUI.rect),this.userData=null},this.ycc.gesture.onzoom=function(t){var e=t.zoomRate;o.width=h.width*e,o.height=h.height*e,o.x=h.x-(o.width-h.width)/2,o.y=h.y-(o.height-h.height)/2}},s.prototype.getCropImage=function(t){var e=this.options.wrapW/2-this.options.cropW/2,i=this.options.wrapH/2-this.options.cropH/2,r=this.options.cropW,n=this.options.cropH;return"wxapp"===this.options.appenv?wx.canvasToTempFilePath({canvasId:t,canvas:this.ycc.canvasDom,x:e,y:i,width:r,height:n,destWidth:r,destHeight:n,fileType:"jpg",quality:1}):this.ycc.ctx.getImageData(e,i,r,n)},s.prototype.clear=function(){this.ycc.layerManager.deleteAllLayer(),this.ycc.ticker.stop()},("undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:void 0).Cropper=s,console.log(s,1111),e.default=s}.call(this,i(2))},function(t,e){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch(t){"object"==typeof window&&(i=window)}t.exports=i}])}));
//# sourceMappingURL=lib.js.map